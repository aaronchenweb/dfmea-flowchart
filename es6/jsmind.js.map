{"version":3,"file":"jsmind.js","sources":["../src/jsmind.common.js","../src/jsmind.dom.js","../src/jsmind.util.js","../src/jsmind.option.js","../src/jsmind.node.js","../src/jsmind.mind.js","../src/jsmind.format.js","../src/jsmind.data_provider.js","../src/jsmind.layout_provider.js","../src/jsmind.graph.js","../src/jsmind.view_provider.js","../src/jsmind.shortcut_provider.js","../src/jsmind.plugin.js","../src/jsmind.js"],"sourcesContent":["/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nexport const __version__ = '0.8.3';\nexport const __author__ = 'hizzgdev@163.com';\n\nif (typeof String.prototype.startsWith != 'function') {\n    String.prototype.startsWith = function (p) {\n        return this.slice(0, p.length) === p;\n    };\n}\n\nexport const Direction = {\n    top: 1.1,\n    left: -1,\n    center: 0,\n    right: 1,\n    down: 2, \n    of: function (dir) {\n        if (!dir || dir === -1 || dir === 0 || dir === 1 || dir === 2 ||dir === 1.1) {\n            return dir;\n        }\n        if (dir === '-1' || dir === '0' || dir === '1' || dir === '2' || dir === '1.1') {\n            return parseInt(dir);\n        }\n        if (dir.toLowerCase() === 'left') {\n            return this.left;\n        }\n        if (dir.toLowerCase() === 'right') {\n            return this.right;\n        }\n        if (dir.toLowerCase() === 'center') {\n            return this.center;\n        }\n        if (dir.toLowerCase() === 'down') {\n            return this.down;\n        }\n        if (dir.toLowerCase() === 'top') {\n            return this.top;\n        }\n    },\n};\nexport const EventType = { show: 1, resize: 2, edit: 3, select: 4 };\nexport const Key = { meta: 1 << 13, ctrl: 1 << 12, alt: 1 << 11, shift: 1 << 10 };\nexport const LogLevel = { debug: 1, info: 2, warn: 3, error: 4, disable: 9 };\n\n// an noop function define\nvar _noop = function () {};\nexport let logger =\n    typeof console === 'undefined'\n        ? {\n              level: _noop,\n              log: _noop,\n              debug: _noop,\n              info: _noop,\n              warn: _noop,\n              error: _noop,\n          }\n        : {\n              level: setup_logger_level,\n              log: console.log,\n              debug: console.debug,\n              info: console.info,\n              warn: console.warn,\n              error: console.error,\n          };\n\nfunction setup_logger_level(log_level) {\n    if (log_level > LogLevel.debug) {\n        logger.debug = _noop;\n    } else {\n        logger.debug = console.debug;\n    }\n    if (log_level > LogLevel.info) {\n        logger.info = _noop;\n    } else {\n        logger.info = console.info;\n    }\n    if (log_level > LogLevel.warn) {\n        logger.warn = _noop;\n    } else {\n        logger.warn = console.warn;\n    }\n    if (log_level > LogLevel.error) {\n        logger.error = _noop;\n    } else {\n        logger.error = console.error;\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nclass Dom {\n    constructor(w) {\n        this.w = w;\n        this.d = w.document;\n        this.g = function (id) {\n            return this.d.getElementById(id);\n        };\n        this.c = function (tag) {\n            return this.d.createElement(tag);\n        };\n        this.t = function (n, t) {\n            if (n.hasChildNodes()) {\n                n.firstChild.nodeValue = t;\n            } else {\n                n.appendChild(this.d.createTextNode(t));\n            }\n        };\n\n        this.h = function (n, t) {\n            if (t instanceof HTMLElement) {\n                n.innerHTML = '';\n                n.appendChild(t);\n            } else {\n                n.innerHTML = t;\n            }\n        };\n        // detect isElement\n        this.i = function (el) {\n            return (\n                !!el &&\n                typeof el === 'object' &&\n                el.nodeType === 1 &&\n                typeof el.style === 'object' &&\n                typeof el.ownerDocument === 'object'\n            );\n        };\n\n        //target,eventType,handler\n        this.on = function (t, e, h) {\n            if (!!t.addEventListener) {\n                t.addEventListener(e, h, false);\n            } else {\n                t.attachEvent('on' + e, h);\n            }\n        };\n\n        this.off = function (t, e, h, c) {\n            if (t.removeEventListener) {\n                t.removeEventListener(e, h, !!c);\n            } else {\n                t.detachEvent('on' + e, h);\n            }\n        };\n    }\n}\n\nexport const $ = new Dom(window);\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from './jsmind.dom.js';\n\nexport const util = {\n    file: {\n        read: function (file_data, fn_callback) {\n            var reader = new FileReader();\n            reader.onload = function () {\n                if (typeof fn_callback === 'function') {\n                    fn_callback(this.result, file_data.name);\n                }\n            };\n            reader.readAsText(file_data);\n        },\n\n        save: function (file_data, type, name) {\n            var blob;\n            if (typeof $.w.Blob === 'function') {\n                blob = new Blob([file_data], { type: type });\n            } else {\n                var BlobBuilder =\n                    $.w.BlobBuilder ||\n                    $.w.MozBlobBuilder ||\n                    $.w.WebKitBlobBuilder ||\n                    $.w.MSBlobBuilder;\n                var bb = new BlobBuilder();\n                bb.append(file_data);\n                blob = bb.getBlob(type);\n            }\n            if (navigator.msSaveBlob) {\n                navigator.msSaveBlob(blob, name);\n            } else {\n                var URL = $.w.URL || $.w.webkitURL;\n                var blob_url = URL.createObjectURL(blob);\n                var anchor = $.c('a');\n                if ('download' in anchor) {\n                    anchor.style.visibility = 'hidden';\n                    anchor.href = blob_url;\n                    anchor.download = name;\n                    $.d.body.appendChild(anchor);\n                    var evt = $.d.createEvent('MouseEvents');\n                    evt.initEvent('click', true, true);\n                    anchor.dispatchEvent(evt);\n                    $.d.body.removeChild(anchor);\n                } else {\n                    location.href = blob_url;\n                }\n            }\n        },\n    },\n\n    json: {\n        json2string: function (json) {\n            return JSON.stringify(json);\n        },\n        string2json: function (json_str) {\n            return JSON.parse(json_str);\n        },\n        merge: function (b, a) {\n            for (var o in a) {\n                if (o in b) {\n                    if (\n                        typeof b[o] === 'object' &&\n                        Object.prototype.toString.call(b[o]).toLowerCase() == '[object object]' &&\n                        !b[o].length\n                    ) {\n                        util.json.merge(b[o], a[o]);\n                    } else {\n                        b[o] = a[o];\n                    }\n                } else {\n                    b[o] = a[o];\n                }\n            }\n            return b;\n        },\n    },\n\n    uuid: {\n        newid: function () {\n            return (\n                new Date().getTime().toString(16) + Math.random().toString(16).substring(2)\n            ).substring(2, 18);\n        },\n    },\n\n    text: {\n        is_empty: function (s) {\n            if (!s) {\n                return true;\n            }\n            return s.replace(/\\s*/, '').length == 0;\n        },\n    },\n};\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { util } from './jsmind.util.js';\n\nconst default_options = {\n    container: '', // id of the container\n    editable: false, // you can change it in your options\n    theme: null,\n    mode: 'full', // full or side\n    support_html: true,\n    log_level: 'info',\n\n    view: {\n        engine: 'canvas',\n        hmargin: 100,\n        vmargin: 50,\n        line_width: 2,\n        line_color: '#555',\n        line_style: 'curved', // [straight | curved]\n        draggable: false, // drag the mind map with your mouse, when it's larger that the container\n        hide_scrollbars_when_draggable: false, // hide container scrollbars, when mind map is larger than container and draggable option is true.\n        node_overflow: 'hidden', // [hidden | wrap]\n        zoom: {\n            min: 0.5,\n            max: 2.1,\n            step: 0.1,\n        },\n        custom_node_render: null,\n        expander_style: 'char', // [char | number]\n    },\n    layout: {\n        // type: 'treeview',\n        hspace: 30,\n        vspace: 20,\n        pspace: 13,\n        cousin_space: 0,\n    },\n    default_event_handle: {\n        enable_mousedown_handle: true,\n        enable_click_handle: true,\n        enable_dblclick_handle: true,\n        enable_mousewheel_handle: true,\n    },\n    shortcut: {\n        enable: true,\n        handles: {},\n        mapping: {\n            addchild: [45, 4096 + 13], // Insert, Ctrl+Enter\n            addbrother: 13, // Enter\n            editnode: 113, // F2\n            delnode: 46, // Delete\n            toggle: 32, // Space\n            left: 37, // Left\n            up: 38, // Up\n            right: 39, // Right\n            down: 40, // Down\n        },\n    },\n    plugin: {},\n};\n\nexport function merge_option(options) {\n    var opts = {};\n    util.json.merge(opts, default_options);\n    util.json.merge(opts, options);\n\n    if (!opts.container) {\n        throw new Error('the options.container should not be null or empty.');\n    }\n    return opts;\n}\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { logger } from './jsmind.common.js';\nexport class Node {\n    constructor(sId, iIndex, sTopic, oData, bIsRoot, oParent, eDirection, bExpanded) {\n        if (!sId) {\n            logger.error('invalid node id');\n            return;\n        }\n        if (typeof iIndex != 'number') {\n            logger.error('invalid node index');\n            return;\n        }\n        if (typeof bExpanded === 'undefined') {\n            bExpanded = true;\n        }\n        this.id = sId;\n        this.index = iIndex;\n        this.topic = sTopic;\n        this.data = oData || {};\n        this.isroot = bIsRoot;\n        this.parent = oParent;\n        this.direction = eDirection;\n        this.expanded = !!bExpanded;\n        this.children = [];\n        this._data = {};\n    }\n\n    get_location() {\n        var vd = this._data.view;\n        return {\n            x: vd.abs_x,\n            y: vd.abs_y,\n        };\n    }\n    get_size() {\n        var vd = this._data.view;\n        return {\n            w: vd.width,\n            h: vd.height,\n        };\n    }\n\n    static compare(node1, node2) {\n        // '-1' is always the latest\n        var r = 0;\n        var i1 = node1.index;\n        var i2 = node2.index;\n        if (i1 >= 0 && i2 >= 0) {\n            r = i1 - i2;\n        } else if (i1 == -1 && i2 == -1) {\n            r = 0;\n        } else if (i1 == -1) {\n            r = 1;\n        } else if (i2 == -1) {\n            r = -1;\n        } else {\n            r = 0;\n        }\n        return r;\n    }\n    static inherited(parent_node, node) {\n        if (!!parent_node && !!node) {\n            if (parent_node.id === node.id) {\n                return true;\n            }\n            if (parent_node.isroot) {\n                return true;\n            }\n            var pid = parent_node.id;\n            var p = node;\n            while (!p.isroot) {\n                p = p.parent;\n                if (p.id === pid) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n    static is_node(n) {\n        return !!n && n instanceof Node;\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { Node } from './jsmind.node.js';\nimport { logger, Direction } from './jsmind.common.js';\n\nexport class Mind {\n    constructor() {\n        this.name = null;\n        this.author = null;\n        this.version = null;\n        this.root = null;\n        this.selected = null;\n        this.nodes = {};\n    }\n    get_node(node_id) {\n        if (node_id in this.nodes) {\n            return this.nodes[node_id];\n        } else {\n            logger.warn('the node[id=' + node_id + '] can not be found');\n            return null;\n        }\n    }\n    set_root(node_id, topic, data) {\n        if (this.root == null) {\n            this.root = new Node(node_id, 0, topic, data, true);\n            this._put_node(this.root);\n            return this.root;\n        } else {\n            logger.error('root node is already exist');\n            return null;\n        }\n    }\n    add_node(parent_node, node_id, topic, data, direction, expanded, idx) {\n        if (!Node.is_node(parent_node)) {\n            logger.error('the parent_node ' + parent_node + ' is not a node.');\n            return null;\n        }\n        var node_index = idx || -1;\n        var node = new Node(\n            node_id,\n            node_index,\n            topic,\n            data,\n            false,\n            parent_node,\n            parent_node.direction,\n            expanded\n        );\n        if (parent_node.isroot) {\n            node.direction = direction || Direction.right;\n        }\n        if (this._put_node(node)) {\n            parent_node.children.push(node);\n            this._update_index(parent_node);\n        } else {\n            logger.error(\"fail, the node id '\" + node.id + \"' has been already exist.\");\n            node = null;\n        }\n        return node;\n    }\n    insert_node_before(node_before, node_id, topic, data, direction) {\n        if (!Node.is_node(node_before)) {\n            logger.error('the node_before ' + node_before + ' is not a node.');\n            return null;\n        }\n        var node_index = node_before.index - 0.5;\n        return this.add_node(node_before.parent, node_id, topic, data, direction, true, node_index);\n    }\n    get_node_before(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return null;\n            } else {\n                return this.get_node_before(the_node);\n            }\n        }\n        if (node.isroot) {\n            return null;\n        }\n        var idx = node.index - 2;\n        if (idx >= 0) {\n            return node.parent.children[idx];\n        } else {\n            return null;\n        }\n    }\n    insert_node_after(node_after, node_id, topic, data, direction) {\n        if (!Node.is_node(node_after)) {\n            logger.error('the node_after ' + node_after + ' is not a node.');\n            return null;\n        }\n        var node_index = node_after.index + 0.5;\n        return this.add_node(node_after.parent, node_id, topic, data, direction, true, node_index);\n    }\n    get_node_after(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return null;\n            } else {\n                return this.get_node_after(the_node);\n            }\n        }\n        if (node.isroot) {\n            return null;\n        }\n        var idx = node.index;\n        var brothers = node.parent.children;\n        if (brothers.length > idx) {\n            return node.parent.children[idx];\n        } else {\n            return null;\n        }\n    }\n    move_node(node, before_id, parent_id, direction) {\n        if (!Node.is_node(node)) {\n            logger.error('the parameter node ' + node + ' is not a node.');\n            return null;\n        }\n        if (!parent_id) {\n            parent_id = node.parent.id;\n        }\n        return this._move_node(node, before_id, parent_id, direction);\n    }\n    _flow_node_direction(node, direction) {\n        if (typeof direction === 'undefined') {\n            direction = node.direction;\n        } else {\n            node.direction = direction;\n        }\n        var len = node.children.length;\n        while (len--) {\n            this._flow_node_direction(node.children[len], direction);\n        }\n    }\n    _move_node_internal(node, before_id) {\n        if (!!node && !!before_id) {\n            if (before_id == '_last_') {\n                node.index = -1;\n                this._update_index(node.parent);\n            } else if (before_id == '_first_') {\n                node.index = 0;\n                this._update_index(node.parent);\n            } else {\n                var node_before = !!before_id ? this.get_node(before_id) : null;\n                if (\n                    node_before != null &&\n                    node_before.parent != null &&\n                    node_before.parent.id == node.parent.id\n                ) {\n                    node.index = node_before.index - 0.5;\n                    this._update_index(node.parent);\n                }\n            }\n        }\n        return node;\n    }\n    _move_node(node, before_id, parent_id, direction) {\n        if (!!node && !!parent_id) {\n            var parent_node = this.get_node(parent_id);\n            if (Node.inherited(node, parent_node)) {\n                logger.error('can not move a node to its children');\n                return null;\n            }\n            if (node.parent.id != parent_id) {\n                // remove from parent's children\n                var sibling = node.parent.children;\n                var si = sibling.length;\n                while (si--) {\n                    if (sibling[si].id == node.id) {\n                        sibling.splice(si, 1);\n                        break;\n                    }\n                }\n                let origin_parent = node.parent;\n                node.parent = parent_node;\n                parent_node.children.push(node);\n                this._update_index(origin_parent);\n            }\n\n            if (node.parent.isroot) {\n                if (direction == Direction.left) {\n                    node.direction = direction;\n                } else {\n                    node.direction = Direction.right;\n                }\n            } else {\n                node.direction = node.parent.direction;\n            }\n            this._move_node_internal(node, before_id);\n            this._flow_node_direction(node);\n        }\n        return node;\n    }\n    remove_node(node) {\n        if (!Node.is_node(node)) {\n            logger.error('the parameter node ' + node + ' is not a node.');\n            return false;\n        }\n        if (node.isroot) {\n            logger.error('fail, can not remove root node');\n            return false;\n        }\n        if (this.selected != null && this.selected.id == node.id) {\n            this.selected = null;\n        }\n        // clean all subordinate nodes\n        var children = node.children;\n        var ci = children.length;\n        while (ci--) {\n            this.remove_node(children[ci]);\n        }\n        // clean all children\n        children.length = 0;\n        var node_parent = node.parent;\n        // remove from parent's children\n        var sibling = node_parent.children;\n        var si = sibling.length;\n        while (si--) {\n            if (sibling[si].id == node.id) {\n                sibling.splice(si, 1);\n                break;\n            }\n        }\n        // remove from global nodes\n        delete this.nodes[node.id];\n        // clean all properties\n        for (var k in node) {\n            delete node[k];\n        }\n        // remove it's self\n        node = null;\n        this._update_index(node_parent);\n        return true;\n    }\n    _put_node(node) {\n        if (node.id in this.nodes) {\n            logger.warn(\"the node_id '\" + node.id + \"' has been already exist.\");\n            return false;\n        } else {\n            this.nodes[node.id] = node;\n            return true;\n        }\n    }\n    _update_index(node) {\n        if (node instanceof Node) {\n            node.children.sort(Node.compare);\n            for (var i = 0; i < node.children.length; i++) {\n                node.children[i].index = i + 1;\n            }\n        }\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { __author__, __version__, logger, Direction } from './jsmind.common.js';\nimport { Mind } from './jsmind.mind.js';\nimport { Node } from './jsmind.node.js';\nimport { util } from './jsmind.util.js';\n\nconst DEFAULT_META = { name: 'jsMind', author: __author__, version: __version__ };\n\nexport const format = {\n    node_tree: {\n        example: {\n            meta: DEFAULT_META,\n            format: 'node_tree',\n            data: { id: 'root', topic: 'jsMind node_tree example' },\n        },\n        get_mind: function (source) {\n            var df = format.node_tree;\n            var mind = new Mind();\n            mind.name = source.meta.name;\n            mind.author = source.meta.author;\n            mind.version = source.meta.version;\n            df._parse(mind, source.data);\n            return mind;\n        },\n        get_data: function (mind) {\n            var df = format.node_tree;\n            var json = {};\n            json.meta = {\n                name: mind.name,\n                author: mind.author,\n                version: mind.version,\n            };\n            json.format = 'node_tree';\n            json.data = df._build_node(mind.root);\n            return json;\n        },\n\n        _parse: function (mind, node_root) {\n            var df = format.node_tree;\n            var data = df._extract_data(node_root);\n            mind.set_root(node_root.id, node_root.topic, data);\n            if ('children' in node_root) {\n                var children = node_root.children;\n                for (var i = 0; i < children.length; i++) {\n                    df._extract_subnode(mind, mind.root, children[i]);\n                }\n            }\n        },\n\n        _extract_data: function (node_json) {\n            var data = {};\n            for (var k in node_json) {\n                if (\n                    k == 'id' ||\n                    k == 'topic' ||\n                    k == 'children' ||\n                    k == 'direction' ||\n                    k == 'expanded'\n                ) {\n                    continue;\n                }\n                data[k] = node_json[k];\n            }\n            return data;\n        },\n\n        _extract_subnode: function (mind, node_parent, node_json) {\n            var df = format.node_tree;\n            var data = df._extract_data(node_json);\n            var d = null;\n            if (node_parent.isroot) {\n                d = node_json.direction == 'left' ? Direction.left : Direction.right;\n            }\n            var node = mind.add_node(\n                node_parent,\n                node_json.id,\n                node_json.topic,\n                data,\n                d,\n                node_json.expanded\n            );\n            if (!!node_json['children']) {\n                var children = node_json.children;\n                for (var i = 0; i < children.length; i++) {\n                    df._extract_subnode(mind, node, children[i]);\n                }\n            }\n        },\n\n        _build_node: function (node) {\n            var df = format.node_tree;\n            if (!(node instanceof Node)) {\n                return;\n            }\n            var o = {\n                id: node.id,\n                topic: node.topic,\n                expanded: node.expanded,\n            };\n            if (!!node.parent && node.parent.isroot) {\n                o.direction = node.direction == Direction.left ? 'left' : 'right';\n            }\n            if (node.data != null) {\n                var node_data = node.data;\n                for (var k in node_data) {\n                    o[k] = node_data[k];\n                }\n            }\n            var children = node.children;\n            if (children.length > 0) {\n                o.children = [];\n                for (var i = 0; i < children.length; i++) {\n                    o.children.push(df._build_node(children[i]));\n                }\n            }\n            return o;\n        },\n    },\n\n    node_array: {\n        example: {\n            meta: DEFAULT_META,\n            format: 'node_array',\n            data: [{ id: 'root', topic: 'jsMind node_array example', isroot: true }],\n        },\n\n        get_mind: function (source) {\n            var df = format.node_array;\n            var mind = new Mind();\n            mind.name = source.meta.name;\n            mind.author = source.meta.author;\n            mind.version = source.meta.version;\n            df._parse(mind, source.data);\n            return mind;\n        },\n\n        get_data: function (mind) {\n            var df = format.node_array;\n            var json = {};\n            json.meta = {\n                name: mind.name,\n                author: mind.author,\n                version: mind.version,\n            };\n            json.format = 'node_array';\n            json.data = [];\n            df._array(mind, json.data);\n            return json;\n        },\n\n        _parse: function (mind, node_array) {\n            var df = format.node_array;\n            var nodes = node_array.slice(0);\n            // reverse array for improving looping performance\n            nodes.reverse();\n            var root_node = df._extract_root(mind, nodes);\n            if (!!root_node) {\n                df._extract_subnode(mind, root_node, nodes);\n            } else {\n                logger.error('root node can not be found');\n            }\n        },\n\n        _extract_root: function (mind, node_array) {\n            var df = format.node_array;\n            var i = node_array.length;\n            while (i--) {\n                if ('isroot' in node_array[i] && node_array[i].isroot) {\n                    var root_json = node_array[i];\n                    var data = df._extract_data(root_json);\n                    var node = mind.set_root(root_json.id, root_json.topic, data);\n                    node_array.splice(i, 1);\n                    return node;\n                }\n            }\n            return null;\n        },\n\n        _extract_subnode: function (mind, parent_node, node_array) {\n            var df = format.node_array;\n            var i = node_array.length;\n            var node_json = null;\n            var data = null;\n            var extract_count = 0;\n            while (i--) {\n                node_json = node_array[i];\n                if (node_json.parentid == parent_node.id) {\n                    data = df._extract_data(node_json);\n                    var d = null;\n                    var node_direction = node_json.direction;\n                    if (node_direction === 'left' || node_direction === 'right' ||  node_direction === 'down' ||  node_direction === 'top') {\n                        if (node_direction === 'left') {\n                            d = Direction.left;\n                        } else if (node_direction === 'right') {\n                            d = Direction.right;\n                        } else if (node_direction === 'down') { \n                            d = Direction.down;\n                        } else {\n                            d = Direction.top;\n                        }\n                    }\n                    // if (!!node_direction) {\n                    //     d = node_direction == 'left' ? Direction.left : Direction.right;\n                    // }\n                    var node = mind.add_node(\n                        parent_node,\n                        node_json.id,\n                        node_json.topic,\n                        data,\n                        d,\n                        node_json.expanded\n                    );\n                    node_array.splice(i, 1);\n                    extract_count++;\n                    var sub_extract_count = df._extract_subnode(mind, node, node_array);\n                    if (sub_extract_count > 0) {\n                        // reset loop index after extract subordinate node\n                        i = node_array.length;\n                        extract_count += sub_extract_count;\n                    }\n                }\n            }\n            return extract_count;\n        },\n\n        _extract_data: function (node_json) {\n            var data = {};\n            for (var k in node_json) {\n                if (\n                    k == 'id' ||\n                    k == 'topic' ||\n                    k == 'parentid' ||\n                    k == 'isroot' ||\n                    k == 'direction' ||\n                    k == 'expanded'\n                ) {\n                    continue;\n                }\n                data[k] = node_json[k];\n            }\n            return data;\n        },\n\n        _array: function (mind, node_array) {\n            var df = format.node_array;\n            df._array_node(mind.root, node_array);\n        },\n\n        _array_node: function (node, node_array) {\n            var df = format.node_array;\n            if (!(node instanceof Node)) {\n                return;\n            }\n            var o = {\n                id: node.id,\n                topic: node.topic,\n                expanded: node.expanded,\n            };\n            if (!!node.parent) {\n                o.parentid = node.parent.id;\n            }\n            if (node.isroot) {\n                o.isroot = true;\n            }\n            if (!!node.parent && node.parent.isroot) {\n                o.direction = node.direction == Direction.right ? 'right' : \n                (node.direction == Direction.down ? 'down' : 'top');\n            }\n            if (node.data != null) {\n                var node_data = node.data;\n                for (var k in node_data) {\n                    o[k] = node_data[k];\n                }\n            }\n            node_array.push(o);\n            var ci = node.children.length;\n            for (var i = 0; i < ci; i++) {\n                df._array_node(node.children[i], node_array);\n            }\n        },\n    },\n\n    freemind: {\n        example: {\n            meta: DEFAULT_META,\n            format: 'freemind',\n            data: '<map version=\"1.0.1\"><node ID=\"root\" TEXT=\"jsMind freemind example\"/></map>',\n        },\n        get_mind: function (source) {\n            var df = format.freemind;\n            var mind = new Mind();\n            mind.name = source.meta.name;\n            mind.author = source.meta.author;\n            mind.version = source.meta.version;\n            var xml = source.data;\n            var xml_doc = df._parse_xml(xml);\n            var xml_root = df._find_root(xml_doc);\n            df._load_node(mind, null, xml_root);\n            return mind;\n        },\n\n        get_data: function (mind) {\n            var df = format.freemind;\n            var json = {};\n            json.meta = {\n                name: mind.name,\n                author: mind.author,\n                version: mind.version,\n            };\n            json.format = 'freemind';\n            var xml_lines = [];\n            xml_lines.push('<map version=\"1.0.1\">');\n            df._build_map(mind.root, xml_lines);\n            xml_lines.push('</map>');\n            json.data = xml_lines.join('');\n            return json;\n        },\n\n        _parse_xml: function (xml) {\n            var xml_doc = null;\n            if (window.DOMParser) {\n                var parser = new DOMParser();\n                xml_doc = parser.parseFromString(xml, 'text/xml');\n            } else {\n                // Internet Explorer\n                xml_doc = new ActiveXObject('Microsoft.XMLDOM');\n                xml_doc.async = false;\n                xml_doc.loadXML(xml);\n            }\n            return xml_doc;\n        },\n\n        _find_root: function (xml_doc) {\n            var nodes = xml_doc.childNodes;\n            var node = null;\n            var root = null;\n            var n = null;\n            for (var i = 0; i < nodes.length; i++) {\n                n = nodes[i];\n                if (n.nodeType == 1 && n.tagName == 'map') {\n                    node = n;\n                    break;\n                }\n            }\n            if (!!node) {\n                var ns = node.childNodes;\n                node = null;\n                for (var i = 0; i < ns.length; i++) {\n                    n = ns[i];\n                    if (n.nodeType == 1 && n.tagName == 'node') {\n                        node = n;\n                        break;\n                    }\n                }\n            }\n            return node;\n        },\n\n        _load_node: function (mind, parent_node, xml_node) {\n            var df = format.freemind;\n            var node_id = xml_node.getAttribute('ID');\n            var node_topic = xml_node.getAttribute('TEXT');\n            var node_folded = xml_node.getAttribute('FOLDED');\n            // look for richcontent\n            if (node_topic == null) {\n                var topic_children = xml_node.childNodes;\n                var topic_child = null;\n                for (var i = 0; i < topic_children.length; i++) {\n                    topic_child = topic_children[i];\n                    if (topic_child.nodeType == 1 && topic_child.tagName === 'richcontent') {\n                        node_topic = topic_child.textContent;\n                        break;\n                    }\n                }\n            }\n            var node_data = df._load_attributes(xml_node);\n            var node_expanded =\n                'expanded' in node_data ? node_data.expanded == 'true' : node_folded != 'true';\n            delete node_data.expanded;\n\n            var node_position = xml_node.getAttribute('POSITION');\n            var node_direction = null;\n            if (!!node_position) {\n                node_direction = node_position == 'left' ? Direction.left : Direction.right;\n            }\n            var node = null;\n            if (!!parent_node) {\n                node = mind.add_node(\n                    parent_node,\n                    node_id,\n                    node_topic,\n                    node_data,\n                    node_direction,\n                    node_expanded\n                );\n            } else {\n                node = mind.set_root(node_id, node_topic, node_data);\n            }\n            var children = xml_node.childNodes;\n            var child = null;\n            for (var i = 0; i < children.length; i++) {\n                child = children[i];\n                if (child.nodeType == 1 && child.tagName == 'node') {\n                    df._load_node(mind, node, child);\n                }\n            }\n        },\n\n        _load_attributes: function (xml_node) {\n            var children = xml_node.childNodes;\n            var attr = null;\n            var attr_data = {};\n            for (var i = 0; i < children.length; i++) {\n                attr = children[i];\n                if (attr.nodeType == 1 && attr.tagName === 'attribute') {\n                    attr_data[attr.getAttribute('NAME')] = attr.getAttribute('VALUE');\n                }\n            }\n            return attr_data;\n        },\n\n        _build_map: function (node, xml_lines) {\n            var df = format.freemind;\n            var pos = null;\n            if (!!node.parent && node.parent.isroot) {\n                pos = node.direction === Direction.left ? 'left' : 'right';\n            }\n            xml_lines.push('<node');\n            xml_lines.push(' ID=\"' + node.id + '\"');\n            if (!!pos) {\n                xml_lines.push(' POSITION=\"' + pos + '\"');\n            }\n            if (!node.expanded) {\n                xml_lines.push(' FOLDED=\"true\"');\n            }\n            xml_lines.push(' TEXT=\"' + df._escape(node.topic) + '\">');\n\n            // for attributes\n            var node_data = node.data;\n            if (node_data != null) {\n                for (var k in node_data) {\n                    xml_lines.push('<attribute NAME=\"' + k + '\" VALUE=\"' + node_data[k] + '\"/>');\n                }\n            }\n\n            // for children\n            var children = node.children;\n            for (var i = 0; i < children.length; i++) {\n                df._build_map(children[i], xml_lines);\n            }\n\n            xml_lines.push('</node>');\n        },\n\n        _escape: function (text) {\n            return text\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/'/g, '&apos;')\n                .replace(/\"/g, '&quot;');\n        },\n    },\n    text: {\n        example: {\n            meta: DEFAULT_META,\n            format: 'text',\n            data: 'jsMind text example\\n node1\\n  node1-sub\\n  node1-sub\\n node2',\n        },\n        _line_regex: /\\s*/,\n        get_mind: function (source) {\n            var df = format.text;\n            var mind = new Mind();\n            mind.name = source.meta.name;\n            mind.author = source.meta.author;\n            mind.version = source.meta.version;\n            var lines = source.data.split(/\\n|\\r/);\n            df._fill_nodes(mind, lines, 0, 0);\n            return mind;\n        },\n\n        _fill_nodes: function (mind, lines) {\n            let node_path = [];\n            let i = 0;\n            while (i < lines.length) {\n                let line = lines[i];\n                let level = line.match(/\\s*/)[0].length;\n                let topic = line.substr(level);\n\n                if (level == 0 && node_path.length > 0) {\n                    log.error('more than 1 root node was found: ' + topic);\n                    return;\n                }\n                if (level > node_path.length) {\n                    log.error('a suspended node was found: ' + topic);\n                    return;\n                }\n                let diff = node_path.length - level;\n                while (diff--) {\n                    node_path.pop();\n                }\n\n                if (level == 0 && node_path.length == 0) {\n                    let node = mind.set_root(util.uuid.newid(), topic);\n                    node_path.push(node);\n                } else {\n                    let node = mind.add_node(\n                        node_path[level - 1],\n                        util.uuid.newid(),\n                        topic,\n                        {},\n                        null\n                    );\n                    node_path.push(node);\n                }\n                i++;\n            }\n            node_path.length = 0;\n        },\n\n        get_data: function (mind) {\n            var df = format.text;\n            var json = {};\n            json.meta = {\n                name: mind.name,\n                author: mind.author,\n                version: mind.version,\n            };\n            json.format = 'text';\n            let lines = [];\n            df._build_lines(lines, [mind.root], 0);\n            json.data = lines.join('\\n');\n            return json;\n        },\n\n        _build_lines: function (lines, nodes, level) {\n            let prefix = new Array(level + 1).join(' ');\n            for (let node of nodes) {\n                lines.push(prefix + node.topic);\n                if (!!node.children) {\n                    format.text._build_lines(lines, node.children, level + 1);\n                }\n            }\n        },\n    },\n};\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { logger } from './jsmind.common.js';\nimport { format } from './jsmind.format.js';\n\nexport class DataProvider {\n    constructor(jm) {\n        this.jm = jm;\n    }\n\n    init() {\n        logger.debug('data.init');\n    }\n    reset() {\n        logger.debug('data.reset');\n    }\n    load(mind_data) {\n        var df = null;\n        var mind = null;\n        if (typeof mind_data === 'object') {\n            if (!!mind_data.format) {\n                df = mind_data.format;\n            } else {\n                df = 'node_tree';\n            }\n        } else {\n            df = 'freemind';\n        }\n\n        if (df == 'node_array') {\n            mind = format.node_array.get_mind(mind_data);\n        } else if (df == 'node_tree') {\n            mind = format.node_tree.get_mind(mind_data);\n        } else if (df == 'freemind') {\n            mind = format.freemind.get_mind(mind_data);\n        } else if (df == 'text') {\n            mind = format.text.get_mind(mind_data);\n        } else {\n            logger.warn('unsupported format');\n        }\n        return mind;\n    }\n    get_data(data_format) {\n        var data = null;\n        if (data_format == 'node_array') {\n            data = format.node_array.get_data(this.jm.mind);\n        } else if (data_format == 'node_tree') {\n            data = format.node_tree.get_data(this.jm.mind);\n        } else if (data_format == 'freemind') {\n            data = format.freemind.get_data(this.jm.mind);\n        } else if (data_format == 'text') {\n            data = format.text.get_data(this.jm.mind);\n        } else {\n            logger.error('unsupported ' + data_format + ' format');\n        }\n        return data;\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\nimport { logger, Direction, EventType } from './jsmind.common.js';\n\nexport class LayoutProvider {\n    constructor(jm, options) {\n        this.opts = options;\n        this.jm = jm;\n        this.isside = this.opts.mode == 'side';\n        this.bounds = null;\n\n        this.cache_valid = false;\n    }\n    init() {\n        logger.debug('layout.init');\n    }\n    reset() {\n        logger.debug('layout.reset');\n        this.bounds = { n: 0, s: 0, w: 0, e: 0 };\n    }\n    calculate_next_child_direction(node) {\n        if (this.isside) {\n            return Direction.right;\n        }\n        var children = node.children || [];\n        var children_len = children.length;\n        var r = 0;\n        for (var i = 0; i < children_len; i++) {\n            if (children[i].direction === Direction.left) {\n                r--;\n            } else {\n                r++;\n            }\n        }\n        return children_len > 1 && r > 0 ? Direction.left : Direction.right;\n    }\n    layout() {\n        logger.debug('layout.layout');\n        this.layout_direction();\n        this.layout_offset();\n    }\n    layout_direction() {\n        this._layout_direction_root();\n    }\n    _layout_direction_root() {\n        var node = this.jm.mind.root;\n        var layout_data = null;\n        if ('layout' in node._data) {\n            layout_data = node._data.layout;\n        } else {\n            layout_data = {};\n            node._data.layout = layout_data;\n        }\n        var children = node.children;\n        var children_count = children.length;\n        layout_data.direction = Direction.center;\n        layout_data.side_index = 0;\n        if (this.isside) {\n            var i = children_count;\n            while (i--) {\n                this._layout_direction_side(children[i], Direction.down, i);\n            }\n        } else {\n            var i = children_count;\n            var subnode = null;\n            while (i--) {\n                subnode = children[i];\n                if (subnode.direction == Direction.left) {\n                    this._layout_direction_side(subnode, Direction.left, i);\n                } else if (subnode.direction == Direction.right) {\n                    this._layout_direction_side(subnode, Direction.right, i);\n                } else if (subnode.direction == Direction.top) {\n                    this._layout_direction_side(subnode, Direction.top, i);\n                } else {\n                    this._layout_direction_side(subnode, Direction.down, i);\n                }\n            }\n        }\n    }\n    _layout_direction_side(node, direction, side_index) {\n        var layout_data = null;\n        if ('layout' in node._data) {\n            layout_data = node._data.layout;\n        } else {\n            layout_data = {};\n            node._data.layout = layout_data;\n        }\n        var children = node.children;\n        var children_count = children.length;\n\n        layout_data.direction = direction;\n        layout_data.side_index = side_index;\n        var i = children_count;\n        while (i--) {\n            this._layout_direction_side(children[i], direction, i);\n        }\n    }\n    layout_offset() {\n        var node = this.jm.mind.root;\n        var layout_data = node._data.layout;\n        layout_data.offset_x = 0;\n        // root 定位點\n        layout_data.offset_y = -300;\n        layout_data.outer_height = 0;\n        var children = node.children;\n        var i = children.length;\n        var left_nodes = [];\n        var right_nodes = [];\n        var down_nodes = [];\n        var top_nodes = [];\n        var subnode = null;\n        while (i--) {\n            subnode = children[i];\n            if (subnode._data.layout.direction == Direction.right) {\n                right_nodes.unshift(subnode);\n            } else if (subnode._data.layout.direction == Direction.left) {\n                left_nodes.unshift(subnode);\n            } else if (subnode._data.layout.direction == Direction.down) {\n                down_nodes.unshift(subnode);\n            } else {\n                top_nodes.unshift(subnode);\n            }\n        }\n        layout_data.left_nodes = left_nodes;\n        layout_data.right_nodes = right_nodes;\n        layout_data.down_nodes = down_nodes;\n        layout_data.top_nodes = top_nodes;\n        layout_data.outer_height_left = this._layout_offset_subnodes(left_nodes);\n        layout_data.outer_height_right = this._layout_offset_right_subnodes(right_nodes);\n        layout_data.outer_height_down = this._layout_offset_subnodes(down_nodes);\n        layout_data.outer_height_top = this._layout_offset_top_subnodes(top_nodes);\n        this.bounds.e = node._data.view.width / 2;\n        this.bounds.w = 0 - this.bounds.e;\n        this.bounds.n = 0;\n        this.bounds.s = Math.max(layout_data.outer_height_left, layout_data.outer_height_right);\n    }\n\n    // layout both the x and y axis\n    _layout_offset_subnodes(nodes) {\n        var total_height = 0;\n        var nodes_count = nodes.length;\n        var i = nodes_count;\n        var node = null;\n        var node_outer_height = 0;\n        var layout_data = null;\n        var base_x = 0;\n        var base_y = 0;\n        var pd = null; // parent._data\n        while (i--) {\n            node = nodes[i];\n            layout_data = node._data.layout;\n            if (pd == null) {\n                pd = node.parent._data;\n            }\n    \n            node_outer_height = this._layout_offset_subnodes(node.children);\n            if (!node.expanded) {\n                node_outer_height = 0;\n                this.set_visible(node.children, false);\n            }\n            node_outer_height = Math.max(node._data.view.height, node_outer_height);\n            if (node.children.length > 1) {\n                node_outer_height += this.opts.cousin_space;\n            }\n\n            layout_data.outer_height = node_outer_height;\n\n            // if ((node.parent.topic === \"element\" && node.topic === \"function\")) {\n            //     layout_data.offset_x = base_x + (pd.view.width * 1.5);\n            //     layout_data.offset_y = base_y + pd.view.height; \n            //     base_y += node_outer_height + (this.opts.vspace);\n            // } else {\n            // }\n\n            if (layout_data.direction === Direction.down) {\n                if (node.data[\"option-color\"] === \"red\") {\n\n                    function findRootAndLongestFunctionWidth(node) {\n                        // Find root\n                        let currentObj = node;\n                        while (currentObj && !currentObj.isroot) {\n                            currentObj = currentObj.parent || null;\n                        }\n                        \n                        if (!currentObj || !currentObj.isroot) {\n                            return { error: \"No root object found\" };\n                        }\n                    \n                        // Filter function nodes and find longest width\n                        let functionLongestWidth = 0;\n                        const functionNodes = currentObj.children.filter(e => e.data[\"option-color\"] === \"#658ef8\");\n                        \n                        functionNodes.forEach(e => {\n                            if (e._data && e._data.view && typeof e._data.view.width === 'number') {\n                                functionLongestWidth = Math.max(functionLongestWidth, e._data.view.width);\n                            }\n                        });\n                    \n                        return {\n                            rootObject: currentObj,\n                            functionNodes: functionNodes,\n                            longestWidth: functionLongestWidth\n                        };\n                    }\n                    \n                    // Usage\n                    const result = findRootAndLongestFunctionWidth(node);\n                    layout_data.offset_x = base_x + result.longestWidth * 1.1;\n                } else {\n                    layout_data.offset_x = base_x;\n                }\n                layout_data.offset_y = base_y + pd.view.height * 1.5; \n                base_y += node_outer_height + this.opts.vspace;\n\n                if (node.data[\"option-color\"] === \"#658ef8\") {\n                    base_y += this.opts.vspace ;\n                }\n\n            } else {\n                layout_data.offset_y = base_y - node_outer_height / 2;\n                layout_data.offset_x =\n                    this.opts.hspace * layout_data.direction +\n                    (pd.view.width * (pd.layout.direction + layout_data.direction)) / 2;\n                // if (node.parent.isroot) {\n                //     layout_data.offset_x += 400; \n                // }\n                if (!node.parent.isroot) {\n                    layout_data.offset_x += this.opts.pspace * layout_data.direction;\n                }\n                base_y = base_y - node_outer_height - this.opts.vspace;\n            }\n            \n\n            total_height += node_outer_height;\n        }\n        if (nodes_count > 1) {\n            total_height += this.opts.vspace * (nodes_count - 1);\n        }\n        i = nodes_count;\n        var middle_height = total_height / 2;\n        while (i--) {\n            node = nodes[i];\n            if (layout_data.direction !== Direction.down) {\n                node._data.layout.offset_y += middle_height;\n            } \n            // else {\n            //     node._data.layout.offset_y += (middle_height / 4);\n            // }\n        }\n        return total_height;\n    }\n\n    _layout_offset_top_subnodes(nodes) {\n        var total_height = 0;\n        var nodes_count = nodes.length;\n        var i = nodes_count;\n        var node = null;\n        var element_node_outer_height = 0;\n        var node_outer_height = 0;\n        var layout_data = null;\n        var el_layout_data = null;\n        var base_x = 0;\n        var base_y = 0;\n        var pd = null; // parent._data\n        var el_base_x = 0;\n        var el_base_y = 0;\n\n        while (i--) {\n            node = nodes[i];\n            if (pd == null) {\n                pd = node.parent._data;\n            }\n            if (node.data[\"option-color\"] === \"black\") {\n                el_layout_data = node._data.layout;\n                el_layout_data.outer_height = element_node_outer_height;\n                element_node_outer_height = Math.max(node._data.view.height, element_node_outer_height);\n                if (node.children.length > 1) {\n                    element_node_outer_height += this.opts.cousin_space;\n                }\n                element_node_outer_height = this._layout_offset_top_subnodes(node.children);\n            } else {\n                layout_data = node._data.layout;\n                layout_data.outer_height = node_outer_height;\n                node_outer_height = Math.max(node._data.view.height, node_outer_height);\n                if (node.children.length > 1) {\n                    node_outer_height += this.opts.cousin_space;\n                }\n                node_outer_height = this._layout_offset_top_subnodes(node.children);\n            }\n\n            \n            if (!node.expanded) {\n                node_outer_height = 0;\n                this.set_visible(node.children, false);\n            }\n\n            \n            if (node.data[\"option-color\"] === \"black\") {\n                el_layout_data.offset_x =\n                    this.opts.hspace * el_layout_data.direction +\n                    ((pd.view.width) * (pd.layout.direction + el_layout_data.direction )) / 2;\n                if (node.parent.isroot) {\n                    const function_node = node.parent.children.filter(e=> e.direction === 2 && e.data[\"option-color\"] === \"#658ef8\");\n\n                    if (function_node.length > 0) {\n                    \n                        let functionWidth = 0\n                        let failureWidth = 0\n\n                        function_node.forEach(e => {\n                            if (functionWidth < e._data.view.width) {\n                                functionWidth = e._data.view.width\n                            }\n                        });\n                    \n                        for (let i = 0; i < function_node.length; i++) {\n                            const element = function_node[i];\n                            for (let j = 0; j < element.children.length; j++) {\n                                if (element.children[j].data[\"option-color\"] === \"red\") {\n                                    if (failureWidth < element.children[j]._data.view.width) {\n                                        failureWidth = element.children[j]._data.view.width\n                                    }\n                                }\n                                \n                            }\n                        }\n                        el_layout_data.offset_x += (functionWidth + failureWidth) + this.opts.hspace; \n                    } else {\n                        el_layout_data.offset_x += pd.view.width; \n                    }\n                    \n                    el_layout_data.offset_y = el_base_y - element_node_outer_height / 2;\n\n                    el_base_y = el_base_y + this.opts.vspace * 2;\n                    total_height += element_node_outer_height;\n\n                    node.parent.children.sort((a, b) => a.index - b.index);\n                \n                    const currentIndex = node.parent.children.findIndex(element => element.index === node.index);\n\n                    if (currentIndex !== -1 && currentIndex < node.parent.children.length - 1) {\n                        const nextNode = node.parent.children[currentIndex + 1];\n                        const nodeFunction = nextNode.children.filter(e=> e.data[\"option-color\"] === \"#658ef8\");\n                        let nodeFailureLength = 0;\n                        for (let i = 0; i < nodeFunction.length; i++) {\n                                const nodeFailure = nodeFunction[i].children.length;\n                                if (nodeFailure) {\n                                    nodeFailureLength += nodeFailure\n                                }\n                        }\n                        const nodeElement = nextNode.children.filter(e=> e.data[\"option-color\"] === \"black\");\n\n                        let level1NodeElNum = nodeElement.length;\n\n                        if (nodeElement && nodeElement.length > 0) {\n                            const level2NodeFunction = [] \n                            const level3NodeFunction = []\n                            let level2nodeFailureLength = 0;\n                            let level3nodeFailureLength = 0;\n                            nodeElement.forEach(node => {\n                                node.children.forEach(childNode => {\n                                    if (childNode.data[\"option-color\"] === \"#658ef8\") {\n                                        level2NodeFunction.push(childNode);\n                                        level2nodeFailureLength += childNode.children ? childNode.children.length : 0;\n                                    }\n                                    if (childNode.children) {\n                                        childNode.children.forEach(grandChildNode => {\n                                            if (grandChildNode.data[\"option-color\"] === \"#658ef8\") {\n                                                level3NodeFunction.push(grandChildNode);\n                                                level3nodeFailureLength += grandChildNode.children ? grandChildNode.children.length : 0;\n                                            }\n                                        });\n                                    }\n                                });\n                            });\n                            let level1NodeFuntionNum = Math.max((nodeFunction.length), (level2NodeFunction.length), (level3NodeFunction.length));\n                            let level3NodeElementNum = 0\n                            for (let i = 0; i < nodeElement.length; i++) {\n                                const element = nodeElement[i].children;\n                                if (element && element.length > 1) {\n                                    for (let j = 0; j < element.length; j++) {\n                                        const elelel = element[j];\n                                        if (elelel.data[\"option-color\"] === \"black\") {\n                                            level3NodeElementNum ++\n                                        }\n                                    }\n                                }\n                            }\n\n                            if (level3NodeElementNum > 1) {\n                                level1NodeElNum += level3NodeElementNum\n                            }\n\n                            if (level1NodeElNum > 0) {\n                                el_layout_data.offset_y +=  this.opts.vspace * 2 * level1NodeElNum\n                                el_base_y +=  this.opts.vspace * 2 * level1NodeElNum\n                            }\n\n                            if (level1NodeFuntionNum > 0) {\n                                el_layout_data.offset_y += this.opts.vspace * 2 * level1NodeFuntionNum\n                                el_base_y +=  this.opts.vspace * 2 * level1NodeFuntionNum\n                            }\n\n                            let nodeFailureNum = nodeFailureLength + level2nodeFailureLength + level3nodeFailureLength\n\n                            if (nodeFailureNum > 0) {\n                                el_layout_data.offset_y += this.opts.vspace * 2.5 * nodeFailureNum\n                                el_base_y +=  this.opts.vspace * 2.5 * nodeFailureNum\n                            }\n\n                        }\n                    }\n\n\n\n                    // const totalNumbers = level1NodeFFNum; \n\n                    // let counter = 0;\n\n                    // for (let i = 0; i < totalNumbers; i++) {\n                    //     counter++;\n                    //     if (counter % 2 === 0) {\n                    //         el_layout_data.offset_y += pd.view.height / 2 \n                    //         el_base_y +=  this.opts.vspace * 3 \n                    //     }\n                    // }\n\n                    // if (level1NodeFFNum > 0) {\n                    //     el_layout_data.offset_y += pd.view.height / 2 * level1NodeFFNum\n                    //     el_base_y +=  this.opts.vspace * 3 * level1NodeFFNum\n                    // }\n\n                } else {\n\n                    el_layout_data.offset_y = el_base_y - element_node_outer_height / 2;\n\n                    el_layout_data.offset_x += this.opts.pspace * el_layout_data.direction;\n\n                    el_base_y = el_base_y  + this.opts.vspace * 2;\n                    total_height += element_node_outer_height;\n\n\n                    // X軸\n                    let function1Width = 0\n                    let failure1Width = 0\n                    let element2Width = 0\n                    let function2Width = 0\n                    let failure2Width = 0\n\n                    if (node.parent.parent.isroot) {\n                        // console.log('level2');\n                        // console.log('node.topic', node.topic);\n                        const funtion_node = node.parent.children.filter(e=> e.data[\"option-color\"] === \"#658ef8\");\n                        funtion_node.forEach(e => {\n                            if (function1Width < e._data.view.width) {\n                                function1Width = e._data.view.width\n                            }\n                        });\n                    \n                        for (let i = 0; i < funtion_node.length; i++) {\n                            const element = funtion_node[i];\n                            for (let j = 0; j < element.children.length; j++) {\n                                if (element.children[j].data[\"option-color\"] === \"red\") {\n                                    if (failure1Width < element.children[j]._data.view.width) {\n                                        failure1Width = element.children[j]._data.view.width\n                                    }\n                                }\n                                \n                            }\n                        }\n                        el_layout_data.offset_x += function1Width + function1Width\n\n                    } else if (node.parent.parent.parent.isroot) {\n                        // console.log('level3');\n                        const nodeElement = node.parent.parent.children.filter(e=> e.data[\"option-color\"] === \"black\");\n\n                        if (nodeElement && nodeElement.length > 0) {\n                            nodeElement.forEach(e=> {\n                                // console.log(e.topic);\n                                // console.log(e._data.view.width);\n                                if (element2Width < e._data.view.width) {\n                                    element2Width = e._data.view.width\n                                   \n                                }\n                            })\n                        }\n\n                        const nodeFunction = [];\n\n                        for (let i = 0; i < nodeElement.length; i++) {\n                            for (let j = 0; j < nodeElement[i].children.length; j++) {\n                                if (nodeElement[i].children[j].data[\"option-color\"] === \"#658ef8\") {\n                                    if (function2Width < nodeElement[i].children[j]._data.view.width) {\n                                        function2Width = nodeElement[i].children[j]._data.view.width\n                                    }\n                                    nodeFunction.push(nodeElement[i].children[j]);\n                                }\n                                \n                            }\n                            \n                        }\n\n                        for (let k = 0; k < nodeFunction.length; k++) {\n                            for (let l = 0; l < nodeFunction[k].children.length; l++) {\n                                if (nodeFunction[k].children[l].data[\"option-color\"] === \"red\") {\n                                    if (failure2Width < nodeFunction[k].children[l]._data.view.width) {\n                                        failure2Width = nodeFunction[k].children[l]._data.view.width\n                                    }\n                                }\n                                \n                            }\n                            \n                        }\n\n                        el_layout_data.offset_x += element2Width + function2Width + failure2Width\n\n                    } \n\n\n                    const allNodes = node.parent.children.sort((a, b) => a.index - b.index);\n\n                    const currentIndexIndex = node.parent.children.findIndex(element => element.index === node.index);\n\n                    if (currentIndexIndex !== -1 && currentIndexIndex < allNodes.length - 1) {\n                        \n                        const nextNode = allNodes[currentIndexIndex + 1];\n                        // const nodeFunction = nextNode.children.filter(e=> e.data[\"option-color\"] === \"#658ef8\");\n                        \n                        // let nodelevel2FunctionNum = 0;\n                        // let nodelevel3FunctionNum = 0;\n\n                        // let nodelevel2FailureNum = 0;\n                        // let nodelevel3FailureNum = 0;\n\n                        // nodelevel2FunctionNum = nodeFunction.length;\n                       \n                        const nodelevel3Element = nextNode.children.filter(e=> e.data[\"option-color\"] === \"black\");\n\n                        if (nodelevel3Element.length > 1) {\n                            el_layout_data.offset_y +=  this.opts.vspace * 2 * nodelevel3Element.length\n                            el_base_y +=  this.opts.vspace * 2 * nodelevel3Element.length\n                        }\n\n                        // if (nodelevel3Element && nodelevel3Element.length > 0) {\n                        //     nodelevel3Element.forEach(e=> {\n                        //        e.children.forEach(ee=> {\n                        //             if (ee.data[\"option-color\"] === \"#658ef8\") {\n                        //                 nodelevel3FunctionNum++\n                        //             }\n                        //             if (ee.children.length > 0) {\n                        //                 nodelevel3FailureNum += ee.children.length\n                        //             }\n                        //        })\n                        //     })\n                        // }\n\n                        // let nodeFuctionNumSum = nodelevel2FunctionNum + nodelevel3FunctionNum\n\n                        // let nodeFailureNumSum = nodelevel2FailureNum + nodelevel3FailureNum\n\n                        // if (nodeFuctionNumSum > 0) {\n                        //     el_layout_data.offset_y += this.opts.vspace * 2 * nodeFuctionNumSum\n                        //     el_base_y +=  this.opts.vspace * 2 * nodeFuctionNumSum\n                        // }\n                        \n                        // if (nodeFailureNumSum > 0) {\n                        //     el_layout_data.offset_y += this.opts.vspace * 2.5 * nodeFailureNumSum\n                        //     el_base_y +=  this.opts.vspace * 2.5 * nodeFailureNumSum\n                        // }\n\n                        if (node.parent.parent.isroot) {\n                            const allNodes = node.parent.children.sort((a, b) => a.index - b.index);\n\n                            const level2Element = allNodes.filter(e=> e.data[\"option-color\"] === \"black\");\n\n                            console.log(allNodes);\n\n                            const currentIndexIndex = node.parent.children.findIndex(element => element.index === node.index);\n                            if (currentIndexIndex !== -1 && currentIndexIndex < level2Element.length - 1) {\n\n                                let level2FunctionNum = 0;\n                                let level2FailureNum = 0;\n\n                                const nextNode = level2Element[currentIndexIndex + 1];\n                                if (nextNode) {\n                                    level2FunctionNum = nextNode.children.length\n                                    \n                                    if (nextNode.children && nextNode.children.length > 0) {\n                                        nextNode.children.forEach(e=>{\n                                            level2FailureNum += e.children.length\n                                        })\n                                    }\n                                    if (level2FunctionNum > 0) {\n                                        el_layout_data.offset_y += this.opts.vspace * 2 * level2FunctionNum\n                                        el_base_y +=  this.opts.vspace * 2 * level2FunctionNum\n                                    }\n\n                                    if (level2FailureNum > 0) {\n                                        el_layout_data.offset_y += this.opts.vspace * 2.5 * level2FailureNum\n                                        el_base_y +=  this.opts.vspace * 2.5 * level2FailureNum\n                                    }\n                                }\n                            }\n                        } else {\n                           \n                            // console.log(nodeFunction);\n                            const allNodes = node.parent.children.sort((a, b) => a.index - b.index);\n\n                            const level3Element = allNodes.filter(e=> e.data[\"option-color\"] === \"black\");\n\n                            const currentIndexIndex = node.parent.children.findIndex(element => element.index === node.index);\n\n                            if (currentIndexIndex !== -1 && currentIndexIndex < level3Element.length - 1) {\n                                // console.log('level3');\n                                // console.log('node.topic', node.topic);\n\n                                let level3FunctionNum = 0;\n                                let level3FailureNum = 0;\n\n                                const nextNode = allNodes[currentIndexIndex + 1];\n                                if (nextNode) {\n                                    level3FunctionNum = nextNode.children.length\n                                    \n                                    if (nextNode.children && nextNode.children.length > 0) {\n                                        nextNode.children.forEach(e=>{\n                                            level3FailureNum += e.children.length\n                                        })\n                                    }\n                                    if (level3FunctionNum > 0) {\n                                        el_layout_data.offset_y += this.opts.vspace * 2 * level3FunctionNum\n                                        el_base_y +=  this.opts.vspace * 2 * level3FunctionNum\n                                    }\n\n                                    if (level3FailureNum > 0) {\n                                        el_layout_data.offset_y += this.opts.vspace * 2.5 * level3FailureNum\n                                        el_base_y +=  this.opts.vspace * 2.5 * level3FailureNum\n                                    }\n                                }\n                            }\n\n\n                        }\n\n                        \n                    }\n                }\n            } else{\n                layout_data.offset_y = base_y + pd.view.height / 2 ;\n                layout_data.offset_x = base_x + (pd.view.width * 1.2);\n                base_y += node_outer_height + this.opts.vspace * 3;\n                const allNodes = node.parent.children.sort((a, b) => a.index - b.index)\n\n                const nodeFF = allNodes.filter(e=> e.data[\"option-color\"] !== \"black\");\n\n                const currentIndexIndex = nodeFF.findIndex(element => element.index === node.index);\n\n                let level2ElementWidth = 0\n\n                let level3ElementWidth = 0\n\n                if (node.data[\"option-color\"] === \"#658ef8\") {\n                    if (node.parent.parent.parent) {\n                        if (node.parent.parent.parent.isroot) {\n                            // console.log('level2');\n                            // console.log('node.topic', node.topic);\n                            const nodeElement = node.parent.parent.children.filter(e=> e.data[\"option-color\"] === \"black\");\n                            if (nodeElement && nodeElement.length > 0) {\n                                nodeElement.forEach(e=> {\n                                    if (level2ElementWidth < e._data.view.width) {\n                                        level2ElementWidth = e._data.view.width\n                                    }\n                                })\n                            }\n    \n                            if (level2ElementWidth > node.parent._data.view.width) {\n                                layout_data.offset_x += ((level2ElementWidth - node.parent._data.view.width)*1.2)\n                            }\n                        } else if (node.parent.parent.parent.parent.isroot) {\n                            // console.log('level3');\n                            // console.log('node.topic', node.topic);\n                            const nodeElement = node.parent.parent.children.filter(e=> e.data[\"option-color\"] === \"black\");\n                            if (nodeElement && nodeElement.length > 0) {\n                                nodeElement.forEach(e=> {\n                                    if (level3ElementWidth < e._data.view.width) {\n                                        level3ElementWidth = e._data.view.width\n                                    }\n                                })\n                            }\n                            if (level3ElementWidth > node.parent._data.view.width) {\n                                layout_data.offset_x += ((level3ElementWidth - node.parent._data.view.width)*1.2)\n                            }\n                        } \n                    }  \n                }\n\n                let level1FuntionWidth = 0\n\n                let level2FuntionWidth = 0\n\n                let level3FuntionWidth = 0\n\n                if (node.data[\"option-color\"] === \"red\") {\n                    if (node.parent.parent.parent.isroot) {\n                        // console.log('level1');\n                        // console.log('node.topic', node.topic);\n                        const nodeFunction = node.parent.parent.children.filter(e=> e.data[\"option-color\"] === \"#658ef8\");\n                        if (nodeFunction && nodeFunction.length > 0) {\n                            nodeFunction.forEach(e=> {\n                                if (level1FuntionWidth < e._data.view.width) {\n                                    level1FuntionWidth = e._data.view.width\n                                }\n                            })\n                        }\n                        if (level1FuntionWidth > node.parent._data.view.width) {\n                            layout_data.offset_x += ((level1FuntionWidth - node.parent._data.view.width)*1.2)\n                        }\n                    } else if (node.parent.parent.parent.parent.isroot) {\n                        // console.log('level2');\n                        // console.log('node.topic', node.topic);\n                        const nodeFunction = node.parent.parent.parent.children.filter(e=> e.data[\"option-color\"] === \"#658ef8\");\n                        if (nodeFunction && nodeFunction.length > 0) {\n                            nodeFunction.forEach(e=> {\n                                if (level2FuntionWidth < e._data.view.width) {\n                                    level2FuntionWidth = e._data.view.width\n                                }\n                            })\n                        }\n\n                        if (level2FuntionWidth > node.parent._data.view.width) {\n                            layout_data.offset_x += ((level2FuntionWidth - node.parent._data.view.width)*1.2)\n                        }\n                    } else {\n                        // console.log('level3');\n                        // console.log('node.topic', node.topic);\n                        const nodeFunction = node.parent.parent.parent.children.filter(e=> e.data[\"option-color\"] === \"#658ef8\");\n                        if (nodeFunction && nodeFunction.length > 0) {\n                            nodeFunction.forEach(e=> {\n                                if (level3FuntionWidth < e._data.view.width) {\n                                    level3FuntionWidth = e._data.view.width\n                                }\n                            })\n                        }\n                        if (level3FuntionWidth > node.parent._data.view.width) {\n                            layout_data.offset_x += ((level3FuntionWidth - node.parent._data.view.width)*1.2)\n                        }\n                    }   \n                }\n\n                let nodeFailureNumSum = 0;\n\n                if (currentIndexIndex !== -1 && currentIndexIndex < nodeFF.length - 1) {\n\n                    const nextNode = nodeFF[currentIndexIndex + 1];\n\n                    const nodelevel3Failure = nextNode.children.filter(e=> e.data[\"option-color\"] === \"red\");\n                    nodeFailureNumSum += nodelevel3Failure.length;\n                }\n\n\n\n                if (nodeFailureNumSum > 0) {\n                    layout_data.offset_y += this.opts.vspace * 2.5 * nodeFailureNumSum\n                    base_y +=  this.opts.vspace * 2.5 * nodeFailureNumSum\n                }\n\n                total_height += node_outer_height \n            }\n        }\n        // if (nodes_count > 1) {\n        //     total_height += this.opts.vspace  * (nodes_count - 1);\n        // }\n        i = nodes_count;\n        var middle_height = total_height / 2;\n        while (i--) {\n            node = nodes[i];\n            node._data.layout.offset_y += middle_height;   \n        }\n        return total_height;\n    }\n\n    _layout_offset_right_subnodes(nodes) {\n        var total_height = 0;\n        var nodes_count = nodes.length;\n        var i = nodes_count;\n        var node = null;\n        var node_outer_height = 0;\n        var layout_data = null;\n        var base_x = 0;\n        var base_y = 0;\n        var pd = null; // parent._data\n        while (i--) {\n            node = nodes[i];\n            layout_data = node._data.layout;\n            if (pd == null) {\n                pd = node.parent._data;\n            }\n    \n            node_outer_height = this._layout_offset_right_subnodes(node.children);\n            if (!node.expanded) {\n                node_outer_height = 0;\n                this.set_visible(node.children, false);\n            }\n            node_outer_height = Math.max(node._data.view.height, node_outer_height);\n            if (node.children.length > 1) {\n                node_outer_height += this.opts.cousin_space;\n            }\n\n            layout_data.outer_height = node_outer_height;\n\n            layout_data.offset_y = base_y - node_outer_height / 2;\n            layout_data.offset_x =\n                this.opts.hspace * layout_data.direction +\n                (pd.view.width * (pd.layout.direction + layout_data.direction)) / 2;\n            if (!node.parent.isroot) {\n                layout_data.offset_x += this.opts.pspace * layout_data.direction;\n            }\n            base_y = base_y - node_outer_height - this.opts.vspace;\n            \n\n            total_height += node_outer_height;\n        }\n        if (nodes_count > 1) {\n            total_height += this.opts.vspace * (nodes_count - 1);\n        }\n        i = nodes_count;\n        var middle_height = total_height / 2;\n        while (i--) {\n            node = nodes[i];\n            if (layout_data.direction !== Direction.down) {\n                node._data.layout.offset_y += middle_height;\n            } \n            // else {\n            //     node._data.layout.offset_y += (middle_height / 4);\n            // }\n        }\n        return total_height;\n    }\n\n    // layout the y axis only, for collapse/expand a node\n    _layout_offset_subnodes_height(nodes) {\n        var total_height = 0;\n        var nodes_count = nodes.length;\n        var i = nodes_count;\n        var node = null;\n        var node_outer_height = 0;\n        var layout_data = null;\n        var base_y = 0;\n        var pd = null; // parent._data\n        while (i--) {\n            node = nodes[i];\n            layout_data = node._data.layout;\n            if (pd == null) {\n                pd = node.parent._data;\n            }\n\n            node_outer_height = this._layout_offset_subnodes_height(node.children);\n            if (!node.expanded) {\n                node_outer_height = 0;\n            }\n            node_outer_height = Math.max(node._data.view.height, node_outer_height);\n            if (node.children.length > 1) {\n                node_outer_height += this.opts.cousin_space;\n            }\n\n            layout_data.outer_height = node_outer_height;\n            layout_data.offset_y = base_y - node_outer_height / 2;\n            base_y = base_y - node_outer_height - this.opts.vspace;\n            total_height += node_outer_height;\n        }\n        if (nodes_count > 1) {\n            total_height += this.opts.vspace * (nodes_count - 1);\n        }\n        i = nodes_count;\n        var middle_height = total_height / 2;\n        while (i--) {\n            node = nodes[i];\n            node._data.layout.offset_y += middle_height;\n        }\n        return total_height;\n    }\n    get_node_offset(node) {\n        var layout_data = node._data.layout;\n        var offset_cache = null;\n        if ('_offset_' in layout_data && this.cache_valid) {\n            offset_cache = layout_data._offset_;\n        } else {\n            offset_cache = { x: -1, y: -1 };\n            layout_data._offset_ = offset_cache;\n        }\n        if (offset_cache.x == -1 || offset_cache.y == -1) {\n            var x = layout_data.offset_x;\n            var y = layout_data.offset_y;\n            if (!node.isroot) {\n                var offset_p = this.get_node_offset(node.parent);\n                x += offset_p.x;\n                y += offset_p.y;\n            }\n            offset_cache.x = x;\n            offset_cache.y = y;\n        }\n        return offset_cache;\n    }\n    get_node_point(node) {\n        var view_data = node._data.view;\n        var offset_p = this.get_node_offset(node);\n        var p = {};\n        node.p = p;\n        if (node.direction === 2) {\n            p.x = offset_p.x + 70 / 2;\n            p.y = offset_p.y - view_data.height / 2;\n        } else {\n            p.x = offset_p.x + (view_data.width * (node._data.layout.direction - 1)) / 2;\n            p.y = offset_p.y - view_data.height / 2;\n        }\n        return p;\n    }\n    get_node_point_in(node) {\n        var p = this.get_node_offset(node);\n        return p;\n    }\n    get_node_point_out(node) {\n        var layout_data = node._data.layout;\n        var pout_cache = null;\n        if ('_pout_' in layout_data && this.cache_valid) {\n            pout_cache = layout_data._pout_;\n        } else {\n            pout_cache = { x: -1, y: -1 };\n            layout_data._pout_ = pout_cache;\n        }\n        if (pout_cache.x == -1 || pout_cache.y == -1) {\n            if (node.isroot) {\n                pout_cache.x = 0;\n                pout_cache.y = 0;\n            } else {\n                var view_data = node._data.view;\n                var offset_p = this.get_node_offset(node);\n                pout_cache.x =\n                    offset_p.x + (view_data.width + this.opts.pspace) * node._data.layout.direction;\n                pout_cache.y = offset_p.y;\n            }\n        }\n        return pout_cache;\n    }\n    get_expander_point(node) {\n        var p = this.get_node_point_out(node);\n        var ex_p = {};\n        if (node._data.layout.direction == Direction.right) {\n            ex_p.x = p.x - this.opts.pspace;\n        } else {\n            ex_p.x = p.x;\n        }\n        ex_p.y = p.y - Math.ceil(this.opts.pspace / 2);\n        return ex_p;\n    }\n    get_min_size() {\n        var nodes = this.jm.mind.nodes;\n        var node = null;\n        var pout = null;\n        for (var node_id in nodes) {\n            node = nodes[node_id];\n            pout = this.get_node_point_out(node);\n            if (pout.x > this.bounds.e) {\n                this.bounds.e = pout.x;\n            }\n            if (pout.x < this.bounds.w) {\n                this.bounds.w = pout.x;\n            }\n        }\n        return {\n            w: this.bounds.e - this.bounds.w,\n            h: this.bounds.s - this.bounds.n,\n        };\n    }\n    toggle_node(node) {\n        if (node.isroot) {\n            return;\n        }\n        if (node.expanded) {\n            this.collapse_node(node);\n        } else {\n            this.expand_node(node);\n        }\n    }\n    expand_node(node) {\n        node.expanded = true;\n        this.part_layout(node);\n        this.set_visible(node.children, true);\n        this.jm.invoke_event_handle(EventType.show, {\n            evt: 'expand_node',\n            data: [],\n            node: node.id,\n        });\n    }\n    collapse_node(node) {\n        node.expanded = false;\n        this.part_layout(node);\n        this.set_visible(node.children, false);\n        this.jm.invoke_event_handle(EventType.show, {\n            evt: 'collapse_node',\n            data: [],\n            node: node.id,\n        });\n    }\n    expand_all() {\n        var nodes = this.jm.mind.nodes;\n        var c = 0;\n        var node;\n        for (var node_id in nodes) {\n            node = nodes[node_id];\n            if (!node.expanded) {\n                node.expanded = true;\n                c++;\n            }\n        }\n        if (c > 0) {\n            var root = this.jm.mind.root;\n            this.part_layout(root);\n            this.set_visible(root.children, true);\n        }\n    }\n    collapse_all() {\n        var nodes = this.jm.mind.nodes;\n        var c = 0;\n        var node;\n        for (var node_id in nodes) {\n            node = nodes[node_id];\n            if (node.expanded && !node.isroot) {\n                node.expanded = false;\n                c++;\n            }\n        }\n        if (c > 0) {\n            var root = this.jm.mind.root;\n            this.part_layout(root);\n            this.set_visible(root.children, true);\n        }\n    }\n    expand_to_depth(target_depth, curr_nodes, curr_depth) {\n        if (target_depth < 1) {\n            return;\n        }\n        var nodes = curr_nodes || this.jm.mind.root.children;\n        var depth = curr_depth || 1;\n        var i = nodes.length;\n        var node = null;\n        while (i--) {\n            node = nodes[i];\n            if (depth < target_depth) {\n                if (!node.expanded) {\n                    this.expand_node(node);\n                }\n                this.expand_to_depth(target_depth, node.children, depth + 1);\n            }\n            if (depth == target_depth) {\n                if (node.expanded) {\n                    this.collapse_node(node);\n                }\n            }\n        }\n    }\n    part_layout(node) {\n        var root = this.jm.mind.root;\n        if (!!root) {\n            var root_layout_data = root._data.layout;\n            if (node.isroot) {\n                root_layout_data.outer_height_right = this._layout_offset_subnodes_height(\n                    root_layout_data.right_nodes\n                );\n                root_layout_data.outer_height_left = this._layout_offset_subnodes_height(\n                    root_layout_data.left_nodes\n                );\n            } else {\n                if (node._data.layout.direction == Direction.right) {\n                    root_layout_data.outer_height_right = this._layout_offset_subnodes_height(\n                        root_layout_data.right_nodes\n                    );\n                } else {\n                    root_layout_data.outer_height_left = this._layout_offset_subnodes_height(\n                        root_layout_data.left_nodes\n                    );\n                }\n            }\n            this.bounds.s = Math.max(\n                root_layout_data.outer_height_left,\n                root_layout_data.outer_height_right\n            );\n            this.cache_valid = false;\n        } else {\n            logger.warn('can not found root node');\n        }\n    }\n    set_visible(nodes, visible) {\n        var i = nodes.length;\n        var node = null;\n        var layout_data = null;\n        while (i--) {\n            node = nodes[i];\n            layout_data = node._data.layout;\n            if (node.expanded) {\n                this.set_visible(node.children, visible);\n            } else {\n                this.set_visible(node.children, false);\n            }\n            if (!node.isroot) {\n                node._data.layout.visible = visible;\n            }\n        }\n    }\n    is_expand(node) {\n        return node.expanded;\n    }\n    is_visible(node) {\n        var layout_data = node._data.layout;\n        if ('visible' in layout_data && !layout_data.visible) {\n            return false;\n        } else {\n            return true;\n        }\n    }\n}\n\n// const obj = {\n//     children: [],\n//     parent:{\n//         children: [],\n//         isroot: false,\n//         topic: \"failure\",\n//         parent:{\n//             children: [],\n//             isroot: false,\n//             topic: \"function\",\n//             id: \"fc3ecd0976daee6f\",\n//             parent:{\n//                 children: [\n//                     {\n//                         children: [], topic: \"element\",\n//                     },\n//                     {\n//                         children: [l], topic: \"function\",id\n//                         : \n//                         \"fc3ecd0976daee6f\"\n//                     },\n//                     {\n//                         children: [l], topic: \"function\",id\n//                         : \n//                         \"fc3eceb078266f20\"\n//                     },\n//                 ],\n//                 isroot: true,\n//                 topic: \"jsMind\"\n//             }\n//         }\n//     },\n//     topic: \"failure\"\n// }\n\n// const obj = {\n//     parent: [{\n//         children: [{\n//             children: [{topic: \"failure\"}], _data: {\n//                 view: {width:70\n//                         }\n//             },\n//             children: [{topic: \"failure\"}], _data: {\n//                 view: {width:70\n//                         }\n//             },\n//             children: [], _data: {\n//                 view: {width:70\n//                         }\n//             }\n//         }], _data: {\n//             view: {width:70\n//                     }\n//         },\n//     }],\n//      children: [{\n//             children: [{topic: \"failure\"}], _data: {\n//                 view: {width:70\n//                         }\n//             },\n//             children: [{topic: \"failure\"}], _data: {\n//                 view: {width:70\n//                         }\n//             },\n//             children: [], _data: {\n//                 view: {width:70\n//                         }\n//             }\n//         }], _data: {\n//             view: {width:70\n//                     }\n//         },\n//     _data: {\n//         view: {width:70\n//                }\n//     },\n//     topic: \"function\"\n// }\n\n// const node = {\n//     children: [{\n//         index: 1\n//     },{\n//         index: 2\n//     }]\n// }\n\n// const node = {\n//     children: [\n//         {\n//             children: [{\n//                 children: [{\n//                     data: optionColor = \"#658ef8\",\n//                 }],\n//                 data: optionColor = \"black\",\n//             }],\n//             data: optionColor = \"#658ef8\",\n//         },\n//         {\n//             children: [{\n//                 children: [{\n//                     data: optionColor = \"black\",\n//                 }],\n//                 data: optionColor = \"#658ef8\",\n//             }],\n//             data: optionColor = \"black\",\n//         }\n//     ],\n//     data: optionColor = \"black\",\n// }","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from './jsmind.dom.js';\n\nclass SvgGraph {\n    constructor(view) {\n        this.view = view;\n        this.opts = view.opts;\n        this.e_svg = SvgGraph.c('svg');\n        this.e_svg.setAttribute('class', 'jsmind');\n        this.size = { w: 0, h: 0 };\n        this.lines = [];\n        this.line_drawing = {\n            straight: this._line_to,\n            curved: this._bezier_to,\n        };\n        this.drawing = this.line_drawing[this.opts.line_style] || this.line_drawing.curved;\n    }\n    static c(tag) {\n        return $.d.createElementNS('http://www.w3.org/2000/svg', tag);\n    }\n    element() {\n        return this.e_svg;\n    }\n    set_size(w, h) {\n        this.size.w = w;\n        this.size.h = h;\n        this.e_svg.setAttribute('width', w);\n        this.e_svg.setAttribute('height', h);\n    }\n    clear() {\n        var len = this.lines.length;\n        while (len--) {\n            this.e_svg.removeChild(this.lines[len]);\n        }\n        this.lines.length = 0;\n    }\n    draw_line(pout, pin, offset, color) {\n        var line = SvgGraph.c('path');\n        line.setAttribute('stroke', color || this.opts.line_color);\n        line.setAttribute('stroke-width', this.opts.line_width);\n        line.setAttribute('fill', 'transparent');\n        this.lines.push(line);\n        this.e_svg.appendChild(line);\n        this.drawing(\n            line,\n            pin.x + offset.x,\n            pin.y + offset.y,\n            pout.x + offset.x,\n            pout.y + offset.y\n        );\n    }\n\n    copy_to(dest_canvas_ctx, callback) {\n        var img = new Image();\n        img.onload = function () {\n            dest_canvas_ctx.drawImage(img, 0, 0);\n            !!callback && callback();\n        };\n        img.src =\n            'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(this.e_svg));\n    }\n    _bezier_to(path, x1, y1, x2, y2) {\n        path.setAttribute(\n            'd',\n            'M ' +\n                x1 +\n                ' ' +\n                y1 +\n                ' C ' +\n                (x1 + ((x2 - x1) * 2) / 3) +\n                ' ' +\n                y1 +\n                ', ' +\n                x1 +\n                ' ' +\n                y2 +\n                ', ' +\n                x2 +\n                ' ' +\n                y2\n        );\n    }\n    _line_to(path, x1, y1, x2, y2) {\n        path.setAttribute('d', 'M ' + x1 + ' ' + y1 + ' L ' + x2 + ' ' + y2);\n    }\n}\n\nclass CanvasGraph {\n    constructor(view) {\n        this.opts = view.opts;\n        this.e_canvas = $.c('canvas');\n        this.e_canvas.className = 'jsmind';\n        this.canvas_ctx = this.e_canvas.getContext('2d');\n        this.size = { w: 0, h: 0 };\n        this.line_drawing = {\n            straight: this._line_to,\n            curved: this._bezier_to,\n        };\n        this.drawing = this.line_drawing[this.opts.line_style] || this.line_drawing.curved;\n    }\n    element() {\n        return this.e_canvas;\n    }\n    set_size(w, h) {\n        this.size.w = w;\n        this.size.h = h;\n        this.e_canvas.width = w;\n        this.e_canvas.height = h;\n    }\n    clear() {\n        this.canvas_ctx.clearRect(0, 0, this.size.w, this.size.h);\n    }\n    draw_line(pout, pin, offset, color) {\n        var ctx = this.canvas_ctx;\n        ctx.strokeStyle = color || this.opts.line_color;\n        ctx.lineWidth = this.opts.line_width;\n        ctx.lineCap = 'round';\n        this.drawing(ctx, pin.x + offset.x, pin.y + offset.y, pout.x + offset.x, pout.y + offset.y);\n    }\n    copy_to(dest_canvas_ctx, callback) {\n        dest_canvas_ctx.drawImage(this.e_canvas, 0, 0);\n        !!callback && callback();\n    }\n    _bezier_to(ctx, x1, y1, x2, y2) {\n        ctx.beginPath();\n        ctx.moveTo(x1, y1);\n        ctx.bezierCurveTo(x1 + ((x2 - x1) * 2) / 3, y1, x1, y2, x2, y2);\n        ctx.stroke();\n    }\n    _line_to(ctx, x1, y1, x2, y2) {\n        ctx.beginPath();\n        ctx.moveTo(x1, y1);\n        ctx.lineTo(x2, y2);\n        ctx.stroke();\n    }\n}\n\nexport function init_graph(view, engine) {\n    return engine.toLowerCase() === 'svg' ? new SvgGraph(view) : new CanvasGraph(view);\n}\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\nimport { logger, EventType, Direction } from './jsmind.common.js';\nimport { $ } from './jsmind.dom.js';\nimport { init_graph } from './jsmind.graph.js';\nimport { util } from './jsmind.util.js';\n\nexport class ViewProvider {\n    constructor(jm, options) {\n        this.opts = options;\n        this.jm = jm;\n        this.layout = jm.layout;\n\n        this.container = null;\n        this.e_panel = null;\n        this.e_nodes = null;\n\n        this.size = { w: 0, h: 0 };\n\n        this.selected_node = null;\n        this.editing_node = null;\n\n        this.graph = null;\n        this.render_node = !!options.custom_node_render\n            ? this._custom_node_render\n            : this._default_node_render;\n        this._initialized = false;\n        this.contextmenu_node_id = null;\n    }\n    init() {\n        logger.debug(this.opts);\n        logger.debug('view.init');\n\n        this.container = $.i(this.opts.container) ? this.opts.container : $.g(this.opts.container);\n        if (!this.container) {\n            logger.error('the options.view.container was not be found in dom');\n            return;\n        }\n        this.graph = init_graph(this, this.opts.engine);\n\n        this.e_panel = $.c('div');\n        this.e_nodes = $.c('jmnodes');\n        this.e_editor = $.c('input');\n        this.e_panel.className = 'jsmind-inner jmnode-overflow-' + this.opts.node_overflow;\n        this.e_panel.tabIndex = 1;\n        this.e_panel.appendChild(this.graph.element());\n        this.e_panel.appendChild(this.e_nodes);\n\n        this.e_editor.className = 'jsmind-editor';\n        this.e_editor.type = 'text';\n\n        this.zoom_current = 1;\n\n        var v = this;\n        $.on(this.e_editor, 'keydown', function (e) {\n            var evt = e || event;\n            if (evt.keyCode == 13) {\n                v.edit_node_end();\n                evt.stopPropagation();\n            }\n        });\n        $.on(this.e_editor, 'blur', function (e) {\n            v.edit_node_end();\n        });\n\n        this.container.appendChild(this.e_panel);\n\n        if (!this.container.offsetParent) {\n            new IntersectionObserver((entities, observer) => {\n                if (entities[0].isIntersecting) {\n                    observer.unobserve(this.e_panel);\n                    this.resize();\n                }\n            }).observe(this.e_panel);\n        }\n    }\n\n    add_event(obj, event_name, event_handle, capture_by_panel) {\n        let target = !!capture_by_panel ? this.e_panel : this.e_nodes;\n        $.on(target, event_name, function (e) {\n            var evt = e || event;\n            event_handle.call(obj, evt);\n        });\n    }\n    get_binded_nodeid(element) {\n        if (element == null) {\n            return null;\n        }\n        var tagName = element.tagName.toLowerCase();\n        if (tagName == 'jmnode' || tagName == 'jmexpander') {\n            return element.getAttribute('nodeid');\n        } else if (tagName == 'jmnodes' || tagName == 'body' || tagName == 'html') {\n            return null;\n        } else {\n            return this.get_binded_nodeid(element.parentElement);\n        }\n    }\n    is_node(element) {\n        if (element == null) {\n            return false;\n        }\n        var tagName = element.tagName.toLowerCase();\n        if (tagName == 'jmnode') {\n            return true;\n        } else if (tagName == 'jmnodes' || tagName == 'body' || tagName == 'html') {\n            return false;\n        } else {\n            return this.is_node(element.parentElement);\n        }\n    }\n    is_expander(element) {\n        return element.tagName.toLowerCase() == 'jmexpander';\n    }\n    reset() {\n        logger.debug('view.reset');\n        this.selected_node = null;\n        this.clear_lines();\n        this.clear_nodes();\n        this.reset_theme();\n    }\n    reset_theme() {\n        var theme_name = this.jm.options.theme;\n        if (!!theme_name) {\n            this.e_nodes.className = 'theme-' + theme_name;\n        } else {\n            this.e_nodes.className = '';\n        }\n    }\n    reset_custom_style() {\n        var nodes = this.jm.mind.nodes;\n        for (var nodeid in nodes) {\n            this.reset_node_custom_style(nodes[nodeid]);\n        }\n    }\n    load() {\n        logger.debug('view.load');\n        this.setup_canvas_draggable(this.opts.draggable);\n        this.init_nodes();\n        this._initialized = true;\n        this.reset_custom_style();\n    }\n    expand_size() {\n        var min_size = this.layout.get_min_size();\n        var min_width = min_size.w + this.opts.hmargin * 2;\n        var min_height = min_size.h + this.opts.vmargin * 2;\n        var client_w = this.e_panel.clientWidth;\n        var client_h = this.e_panel.clientHeight;\n        if (client_w < min_width) {\n            client_w = min_width;\n        }\n        if (client_h < min_height) {\n            client_h = min_height;\n        }\n        this.size.w = client_w;\n        this.size.h = client_h;\n    }\n    init_nodes_size(node) {\n        var view_data = node._data.view;\n        view_data.width = view_data.element.clientWidth;\n        view_data.height = view_data.element.clientHeight;\n    }\n    init_nodes() {\n        var nodes = this.jm.mind.nodes;\n        var doc_frag = $.d.createDocumentFragment();\n        for (var nodeid in nodes) {\n            this.create_node_element(nodes[nodeid], doc_frag);\n        }\n        this.e_nodes.appendChild(doc_frag);\n\n        this.run_in_c11y_mode_if_needed(() => {\n            for (var nodeid in nodes) {\n                this.init_nodes_size(nodes[nodeid]);\n            }\n        });\n    }\n    add_node(node) {\n        this.create_node_element(node, this.e_nodes);\n        this.run_in_c11y_mode_if_needed(() => {\n            this.init_nodes_size(node);\n        });\n    }\n    run_in_c11y_mode_if_needed(func) {\n        if (!!this.container.offsetParent) {\n            func();\n            return;\n        }\n        logger.warn(\n            'init nodes in compatibility mode. because the container or its parent has style {display:none}. '\n        );\n        this.e_panel.style.position = 'absolute';\n        this.e_panel.style.top = '-100000';\n        $.d.body.appendChild(this.e_panel);\n        func();\n        this.container.appendChild(this.e_panel);\n        this.e_panel.style.position = null;\n        this.e_panel.style.top = null;\n    }\n    create_node_element(node, parent_node) {\n        var view_data = null;\n        if ('view' in node._data) {\n            view_data = node._data.view;\n        } else {\n            view_data = {};\n            node._data.view = view_data;\n        }\n\n        var d = $.c('jmnode');\n        if (node.isroot) {\n            d.className = 'root';\n        } else {\n            var d_e = $.c('jmexpander');\n            $.t(d_e, '-');\n            d_e.setAttribute('nodeid', node.id);\n            d_e.style.visibility = 'hidden';\n            parent_node.appendChild(d_e);\n            view_data.expander = d_e;\n        }\n        if (!!node.topic) {\n            this.render_node(d, node);\n        }\n        d.setAttribute('nodeid', node.id);\n        d.style.visibility = 'hidden';\n        this._reset_node_custom_style(d, node.data);\n\n        parent_node.appendChild(d);\n        view_data.element = d;\n    }\n    remove_node(node) {\n        if (this.selected_node != null && this.selected_node.id == node.id) {\n            this.selected_node = null;\n        }\n        if (this.editing_node != null && this.editing_node.id == node.id) {\n            node._data.view.element.removeChild(this.e_editor);\n            this.editing_node = null;\n        }\n        var children = node.children;\n        var i = children.length;\n        while (i--) {\n            this.remove_node(children[i]);\n        }\n        if (node._data.view) {\n            var element = node._data.view.element;\n            var expander = node._data.view.expander;\n            this.e_nodes.removeChild(element);\n            this.e_nodes.removeChild(expander);\n            node._data.view.element = null;\n            node._data.view.expander = null;\n        }\n    }\n    update_node(node) {\n        var view_data = node._data.view;\n        var element = view_data.element;\n        if (!!node.topic) {\n            this.render_node(element, node);\n        }\n        if (this.layout.is_visible(node)) {\n            view_data.width = element.clientWidth;\n            view_data.height = element.clientHeight;\n        } else {\n            let origin_style = element.getAttribute('style');\n            element.style = 'visibility: visible; left:0; top:0;';\n            view_data.width = element.clientWidth;\n            view_data.height = element.clientHeight;\n            element.style = origin_style;\n        }\n    }\n    select_node(node) {\n        if (!!this.selected_node) {\n            var element = this.selected_node._data.view.element;\n            element.className = element.className.replace(/\\s*selected\\b/i, '');\n            this.restore_selected_node_custom_style(this.selected_node);\n        }\n        if (!!node) {\n            this.selected_node = node;\n            node._data.view.element.className += ' selected';\n            this.clear_selected_node_custom_style(node);\n        }\n    }\n    select_clear() {\n        this.select_node(null);\n    }\n    get_editing_node() {\n        return this.editing_node;\n    }\n    is_editing() {\n        return !!this.editing_node;\n    }\n    edit_node_begin(node) {\n        if (!node.topic) {\n            logger.warn(\"don't edit image nodes\");\n            return;\n        }\n        if (this.editing_node != null) {\n            this.edit_node_end();\n        }\n        this.editing_node = node;\n        var view_data = node._data.view;\n        var element = view_data.element;\n        var topic = node.topic;\n        var ncs = getComputedStyle(element);\n        this.e_editor.value = topic;\n        this.e_editor.style.width =\n            element.clientWidth -\n            parseInt(ncs.getPropertyValue('padding-left')) -\n            parseInt(ncs.getPropertyValue('padding-right')) +\n            'px';\n        element.innerHTML = '';\n        element.appendChild(this.e_editor);\n        element.style.zIndex = 5;\n        this.e_editor.focus();\n        this.e_editor.select();\n    }\n    edit_node_end() {\n        if (this.editing_node != null) {\n            var node = this.editing_node;\n            this.editing_node = null;\n            var view_data = node._data.view;\n            var element = view_data.element;\n            var topic = this.e_editor.value;\n            element.style.zIndex = 'auto';\n            element.removeChild(this.e_editor);\n            if (util.text.is_empty(topic) || node.topic === topic) {\n                this.render_node(element, node);\n            } else {\n                this.jm.update_node(node.id, topic);\n            }\n        }\n        this.e_panel.focus();\n    }\n    get_view_offset() {\n        var bounds = this.layout.bounds;\n        var _x = (this.size.w - bounds.e - bounds.w) / 2;\n        var _y = this.size.h / 2;\n        return { x: _x, y: _y };\n    }\n    resize() {\n        this.graph.set_size(1, 1);\n        this.e_nodes.style.width = '1px';\n        this.e_nodes.style.height = '1px';\n\n        this.expand_size();\n        this._show();\n    }\n    _show() {\n        this.graph.set_size(this.size.w, this.size.h);\n        this.e_nodes.style.width = this.size.w + 'px';\n        this.e_nodes.style.height = this.size.h + 'px';\n        // this.layout.layout();\n        this.show_nodes();\n        this.show_lines();\n        //this.layout.cache_valid = true;\n        this.jm.invoke_event_handle(EventType.resize, { data: [] });\n    }\n    zoom_in(e) {\n        return this.set_zoom(this.zoom_current + this.opts.zoom.step, e);\n    }\n    zoom_out(e) {\n        return this.set_zoom(this.zoom_current - this.opts.zoom.step, e);\n    }\n    set_zoom(zoom, e) {\n        if (zoom < this.opts.zoom.min || zoom > this.opts.zoom.max) {\n            return false;\n        }\n        let e_panel_rect = this.e_panel.getBoundingClientRect();\n        if (\n            zoom < 1 &&\n            zoom < this.zoom_current &&\n            this.size.w * zoom < e_panel_rect.width &&\n            this.size.h * zoom < e_panel_rect.height\n        ) {\n            return false;\n        }\n        let zoom_center = !!e\n            ? { x: e.x - e_panel_rect.x, y: e.y - e_panel_rect.y }\n            : { x: e_panel_rect.width / 2, y: e_panel_rect.height / 2 };\n        let panel_scroll_x =\n            ((this.e_panel.scrollLeft + zoom_center.x) * zoom) / this.zoom_current - zoom_center.x;\n        let panel_scroll_y =\n            ((this.e_panel.scrollTop + zoom_center.y) * zoom) / this.zoom_current - zoom_center.y;\n\n        this.zoom_current = zoom;\n        for (var i = 0; i < this.e_panel.children.length; i++) {\n            this.e_panel.children[i].style.zoom = zoom;\n        }\n        this._show();\n        this.e_panel.scrollLeft = panel_scroll_x;\n        this.e_panel.scrollTop = panel_scroll_y;\n        return true;\n    }\n    show(keep_center) {\n        logger.debug('view.show');\n        this.expand_size();\n        this._show();\n        if (!!keep_center) {\n            this.center_node(this.jm.mind.root);\n        }\n    }\n    relayout() {\n        this.expand_size();\n        this._show();\n    }\n    save_location(node) {\n        var vd = node._data.view;\n        vd._saved_location = {\n            x: parseInt(vd.element.style.left) - this.e_panel.scrollLeft,\n            y: parseInt(vd.element.style.top) - this.e_panel.scrollTop,\n        };\n    }\n    restore_location(node) {\n        var vd = node._data.view;\n        this.e_panel.scrollLeft = parseInt(vd.element.style.left) - vd._saved_location.x;\n        this.e_panel.scrollTop = parseInt(vd.element.style.top) - vd._saved_location.y;\n    }\n    clear_nodes() {\n        var mind = this.jm.mind;\n        if (mind == null) {\n            return;\n        }\n        var nodes = mind.nodes;\n        var node = null;\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            node._data.view.element = null;\n            node._data.view.expander = null;\n        }\n        this.e_nodes.innerHTML = '';\n    }\n    show_nodes() {\n        var nodes = this.jm.mind.nodes;\n        var node = null;\n        var node_element = null;\n        var p = null;\n        var view_data = null;\n        var view_offset = this.get_view_offset();\n        var firstElementView = null;\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            view_data = node._data.view;\n            node_element = view_data.element;\n            if (!this.layout.is_visible(node)) {\n                node_element.style.display = 'none';\n                view_data.expander.style.display = 'none';\n                continue;\n            }\n            this.reset_node_custom_style(node);\n            p = this.layout.get_node_point(node);\n            view_data.abs_x = view_offset.x + p.x;\n            view_data.abs_y = view_offset.y + p.y;\n            // if (node.direction === 1.1 && node.parent.isroot) {\n            //     if (node && node.p !== undefined) {\n            //         firstElementView = view_data;\n            //     }\n            // }\n            // if (!node.isroot && !node.parent.isroot && node.direction === 1.1 && node.data[\"option-color\"] === \"black\") {\n            //     if (node.index === 1) {\n            //         node_element.style.top = firstElementView.abs_y + 'px';\n            //     } else {\n            //         node_element.style.top = firstElementView.abs_y + ((view_data.height * 1.5) * node.index) - 58 + 'px';\n            //     }\n            // } else {\n            //     node_element.style.top = view_offset.y + p.y + 'px';\n            // }\n            node_element.style.left = view_offset.x + p.x + 'px';\n            node_element.style.top = view_offset.y + p.y + 'px';\n            node_element.style.display = '';\n            node_element.style.visibility = 'visible';\n            this._show_expander(node, view_offset);\n        }\n    }\n    _show_expander(node, view_offset) {\n        if (node.isroot) {\n            return;\n        }\n\n        var expander = node._data.view.expander;\n        if (node.children.length == 0) {\n            expander.style.display = 'none';\n            expander.style.visibility = 'hidden';\n            return;\n        }\n\n        let expander_text = this._get_expander_text(node);\n        $.t(expander, expander_text);\n\n        let p_expander = this.layout.get_expander_point(node);\n        expander.style.left = view_offset.x + p_expander.x + 'px';\n        expander.style.top = view_offset.y + p_expander.y + 'px';\n        expander.style.display = '';\n        expander.style.visibility = 'visible';\n    }\n\n    _get_expander_text(node) {\n        let style = !!this.opts.expander_style ? this.opts.expander_style.toLowerCase() : 'char';\n        if (style === 'number') {\n            return node.children.length > 99 ? '...' : node.children.length;\n        }\n        if (style === 'char') {\n            return node.expanded ? '-' : '+';\n        }\n    }\n\n    _default_node_render(ele, node) {\n        if (this.opts.support_html) {\n            $.h(ele, node.topic);\n        } else {\n            $.t(ele, node.topic);\n        }\n    }\n    _custom_node_render(ele, node) {\n        let rendered = this.opts.custom_node_render(this.jm, ele, node);\n        if (!rendered) {\n            this._default_node_render(ele, node);\n        }\n    }\n    reset_node_custom_style(node) {\n        this._reset_node_custom_style(node._data.view.element, node.data);\n    }\n    _reset_node_custom_style(node_element, node_data) {\n        if ('background-color' in node_data) {\n            node_element.style.backgroundColor = node_data['background-color'];\n        }\n        if ('foreground-color' in node_data) {\n            node_element.style.color = node_data['foreground-color'];\n        }\n        if ('width' in node_data) {\n            node_element.style.width = node_data['width'] + 'px';\n        }\n        if ('height' in node_data) {\n            node_element.style.height = node_data['height'] + 'px';\n        }\n        if ('font-size' in node_data) {\n            node_element.style.fontSize = node_data['font-size'] + 'px';\n        }\n        if ('font-weight' in node_data) {\n            node_element.style.fontWeight = node_data['font-weight'];\n        }\n        if ('font-style' in node_data) {\n            node_element.style.fontStyle = node_data['font-style'];\n        }\n        if ('background-image' in node_data) {\n            var backgroundImage = node_data['background-image'];\n            if (backgroundImage.startsWith('data') && node_data['width'] && node_data['height']) {\n                var img = new Image();\n\n                img.onload = function () {\n                    var c = $.c('canvas');\n                    c.width = node_element.clientWidth;\n                    c.height = node_element.clientHeight;\n                    var img = this;\n                    if (c.getContext) {\n                        var ctx = c.getContext('2d');\n                        ctx.drawImage(\n                            img,\n                            2,\n                            2,\n                            node_element.clientWidth,\n                            node_element.clientHeight\n                        );\n                        var scaledImageData = c.toDataURL();\n                        node_element.style.backgroundImage = 'url(' + scaledImageData + ')';\n                    }\n                };\n                img.src = backgroundImage;\n            } else {\n                node_element.style.backgroundImage = 'url(' + backgroundImage + ')';\n            }\n            node_element.style.backgroundSize = '99%';\n\n            if ('background-rotation' in node_data) {\n                node_element.style.transform =\n                    'rotate(' + node_data['background-rotation'] + 'deg)';\n            }\n        }\n        if ('option-color' in node_data) {\n            node_element.style.borderBottom = '5px solid ' + node_data['option-color'];\n        }\n    }\n    restore_selected_node_custom_style(node) {\n        var node_element = node._data.view.element;\n        var node_data = node.data;\n        if ('background-color' in node_data) {\n            node_element.style.backgroundColor = node_data['background-color'];\n        }\n        if ('foreground-color' in node_data) {\n            node_element.style.color = node_data['foreground-color'];\n        }\n    }\n    clear_selected_node_custom_style(node) {\n        var node_element = node._data.view.element;\n        node_element.style.backgroundColor = '';\n        node_element.style.color = '';\n    }\n    clear_lines() {\n        this.graph.clear();\n    }\n    show_lines() {\n        this.clear_lines();\n        var nodes = this.jm.mind.nodes;\n        var node = null;\n        var pin = null;\n        var pout = null;\n        var color = null;\n        var _offset = this.get_view_offset();\n        for (var nodeid in nodes) {\n            node = nodes[nodeid];\n            if (!!node.isroot) {\n                continue;\n            }\n            if (!this.layout.is_visible(node)) {\n                continue;\n            }\n            pin = this.layout.get_node_point_in(node);\n            pout = this.layout.get_node_point_out(node.parent);\n            color = node.data['leading-line-color'];\n            // if (node._data.layout.direction === Direction.down) {\n            //     // pin.x = node._data.layout.outer_height;\n            // } else {\n            //     this.graph.draw_line(pout, pin, _offset, color);\n            // }\n        }\n    }\n    // Drag the whole mind map with your mouse, when it's larger that the container\n    setup_canvas_draggable(enabled) {\n        this.opts.draggable = enabled;\n        if (!this._initialized) {\n            let dragging = false;\n            let x, y;\n            if (this.opts.hide_scrollbars_when_draggable) {\n                // Avoid scrollbars when mind map is larger than the container (e_panel = id jsmind-inner)\n                this.e_panel.style = 'overflow: hidden';\n            }\n            // Move the whole mind map with mouse moves, while button is down.\n            $.on(this.container, 'mousedown', eventDown => {\n                if (this.opts.draggable) {\n                    dragging = true;\n                    // Record current mouse position.\n                    x = eventDown.clientX;\n                    y = eventDown.clientY;\n                }\n            });\n            // Stop moving mind map once mouse button is released.\n            $.on(this.container, 'mouseup', () => {\n                dragging = false;\n            });\n            // Follow current mouse position and move mind map accordingly.\n            $.on(this.container, 'mousemove', eventMove => {\n                if (this.opts.draggable) {\n                    if (dragging) {\n                        this.e_panel.scrollBy(x - eventMove.clientX, y - eventMove.clientY);\n                        // Record new current position.\n                        x = eventMove.clientX;\n                        y = eventMove.clientY;\n                    }\n                }\n            });\n        }\n    }\n    center_node(node) {\n        if (!this.layout.is_visible(node)) {\n            logger.warn('can not scroll to the node, because it is invisible');\n            return false;\n        }\n        let view_data = node._data.view;\n        let e_panel_rect = this.e_panel.getBoundingClientRect();\n        let node_center_point = {\n            x: view_data.abs_x + view_data.width / 2,\n            y: view_data.abs_y + view_data.height / 2,\n        };\n        this.e_panel.scrollTo(\n            node_center_point.x * this.zoom_current - e_panel_rect.width / 2,\n            node_center_point.y * this.zoom_current - e_panel_rect.height / 2\n        );\n        return true;\n    }\n\n    zoomIn(e) {\n        logger.warn('please use zoom_in instead');\n        return this.zoom_in(e);\n    }\n    zoomOut(e) {\n        logger.warn('please use zoom_out instead');\n        return this.zoom_out(e);\n    }\n    setZoom(zoom, e) {\n        logger.warn('please use set_zoom instead');\n        return this.set_zoom(zoom, e);\n    }\n\n    show_contextmenu(node_id, x, y) {\n        if (this.contextmenu_node_id !== null) {\n            this.hide_contextmenu();\n        }\n        this.contextmenu_node_id = node_id;\n\n        var node = this.jm.mind.get_node(node_id);\n        var menu = $.c('div');\n        menu.className = 'jsmind-contextmenu';\n\n        if (node.isroot || node.data['option-color'] === 'black') {\n            if (node.parent.isroot || node.parent.parent.isroot) {\n                menu.innerHTML = `\n                <div class=\"menu-item\" data-action=\"element\">element</div>\n                <div class=\"menu-item\" data-action=\"function\">function</div>\n                `;\n            } else {\n                menu.innerHTML = `\n                <div class=\"menu-item\" data-action=\"function\">function</div>\n                `;\n            }\n        } else if (node.data['option-color'] === '#658ef8') {\n            menu.innerHTML = `\n                <div class=\"menu-item\" data-action=\"failure\">failure</div>\n            `;\n        } else if (node.data['option-color'] === 'red') {\n            return\n        }\n\n        $.on(menu, 'click', this._contextmenu_item_click.bind(this, node_id));\n        this.e_panel.appendChild(menu);\n\n        var node_element = this.jm.mind.get_node(node_id)._data.view.element;\n        var node_rect = node_element.getBoundingClientRect();\n        var panel_rect = this.e_panel.getBoundingClientRect();\n\n        var left = x - panel_rect.left + this.e_panel.scrollLeft;\n        var top = y - panel_rect.top + this.e_panel.scrollTop;\n\n        menu.style.left = left + 'px';\n        menu.style.top = top + 'px';\n        menu.style.minWidth = '74px'; // Add this line\n        menu.style.minHeight = '38px'; // Add this line\n\n        var hideFn = this.hide_contextmenu.bind(this);\n        $.on(document, 'click', hideFn);\n        this._menu_close_handler = hideFn;\n    }\n\n    hide_contextmenu() {\n        var menus = this.e_panel.querySelectorAll('.jsmind-contextmenu');\n        for (var i = 0; i < menus.length; i++) {\n            this.e_panel.removeChild(menus[i]);\n        }\n        if (this._menu_close_handler) {\n            $.off(document, 'click', this._menu_close_handler);\n            this._menu_close_handler = null;\n        }\n        this.contextmenu_node_id = null;\n    }\n\n    _contextmenu_item_click(node_id, e) {\n        e.stopPropagation();\n        var action = e.target.getAttribute('data-action');\n        if (!action) return;\n\n\n        var option_color, node_topic, node_direction;\n        var parent_node = this.jm.mind.get_node(node_id);\n\n        switch (action) {\n            case 'function':\n                option_color = '#658ef8';\n                node_topic = 'function';\n                node_direction = parent_node.isroot || parent_node.data['option-color'] === 'black' ? Direction.down : Direction.top;\n                break;\n            case 'failure':\n                option_color = 'red';\n                node_topic = 'failure';\n                node_direction = Direction.top;\n                break;\n            case 'element':\n                option_color = 'black';\n                node_topic = 'element';\n                node_direction = Direction.top;\n                break;\n            default:\n                return;\n        }\n\n        var new_node_id = jsMind.util.uuid.newid();\n        var new_node = this.jm.add_node(parent_node, new_node_id, node_topic, {\n            'option-color': option_color,\n        }, node_direction);\n        if (new_node) {\n            this.jm.select_node(new_node);\n            this.jm.begin_edit(new_node);\n            this.set_node_option_color(new_node, option_color);\n        }\n        this.hide_contextmenu();\n    }\n\n    set_node_option_color(node, color) {\n        var node_element = node._data.view.element;\n        node_element.style.borderBottom = '5px solid ' + color;\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from './jsmind.dom.js';\nimport { util } from './jsmind.util.js';\nimport { Direction } from './jsmind.common.js';\n\nexport class ShortcutProvider {\n    constructor(jm, options) {\n        this.jm = jm;\n        this.opts = options;\n        this.mapping = options.mapping;\n        this.handles = options.handles;\n        this._newid = null;\n        this._mapping = {};\n    }\n    init() {\n        $.on(this.jm.view.e_panel, 'keydown', this.handler.bind(this));\n\n        this.handles['addchild'] = this.handle_addchild;\n        this.handles['addbrother'] = this.handle_addbrother;\n        this.handles['editnode'] = this.handle_editnode;\n        this.handles['delnode'] = this.handle_delnode;\n        this.handles['toggle'] = this.handle_toggle;\n        this.handles['up'] = this.handle_up;\n        this.handles['down'] = this.handle_down;\n        this.handles['left'] = this.handle_left;\n        this.handles['right'] = this.handle_right;\n\n        for (var handle in this.mapping) {\n            if (!!this.mapping[handle] && handle in this.handles) {\n                let keys = this.mapping[handle];\n                if (!Array.isArray(keys)) {\n                    keys = [keys];\n                }\n                for (let key of keys) {\n                    this._mapping[key] = this.handles[handle];\n                }\n            }\n        }\n\n        if (typeof this.opts.id_generator === 'function') {\n            this._newid = this.opts.id_generator;\n        } else {\n            this._newid = util.uuid.newid;\n        }\n    }\n    enable_shortcut() {\n        this.opts.enable = true;\n    }\n    disable_shortcut() {\n        this.opts.enable = false;\n    }\n    handler(e) {\n        if (e.which == 9) {\n            e.preventDefault();\n        } //prevent tab to change focus in browser\n        if (this.jm.view.is_editing()) {\n            return;\n        }\n        var evt = e || event;\n        if (!this.opts.enable) {\n            return true;\n        }\n        var kc =\n            evt.keyCode +\n            (evt.metaKey << 13) +\n            (evt.ctrlKey << 12) +\n            (evt.altKey << 11) +\n            (evt.shiftKey << 10);\n        if (kc in this._mapping) {\n            this._mapping[kc].call(this, this.jm, e);\n        }\n    }\n    handle_addchild(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            var node_id = this._newid();\n            var node = _jm.add_node(selected_node, node_id, 'New Node');\n            if (!!node) {\n                _jm.select_node(node_id);\n                _jm.begin_edit(node_id);\n            }\n        }\n    }\n    handle_addbrother(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node && !selected_node.isroot) {\n            var node_id = this._newid();\n            var node = _jm.insert_node_after(selected_node, node_id, 'New Node');\n            if (!!node) {\n                _jm.select_node(node_id);\n                _jm.begin_edit(node_id);\n            }\n        }\n    }\n    handle_editnode(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            _jm.begin_edit(selected_node);\n        }\n    }\n    handle_delnode(_jm, e) {\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node && !selected_node.isroot) {\n            _jm.select_node(selected_node.parent);\n            _jm.remove_node(selected_node);\n        }\n    }\n    handle_toggle(_jm, e) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            _jm.toggle_node(selected_node.id);\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n    handle_up(_jm, e) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            var up_node = _jm.find_node_before(selected_node);\n            if (!up_node) {\n                var np = _jm.find_node_before(selected_node.parent);\n                if (!!np && np.children.length > 0) {\n                    up_node = np.children[np.children.length - 1];\n                }\n            }\n            if (!!up_node) {\n                _jm.select_node(up_node);\n            }\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n    handle_down(_jm, e) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        if (!!selected_node) {\n            var down_node = _jm.find_node_after(selected_node);\n            if (!down_node) {\n                var np = _jm.find_node_after(selected_node.parent);\n                if (!!np && np.children.length > 0) {\n                    down_node = np.children[0];\n                }\n            }\n            if (!!down_node) {\n                _jm.select_node(down_node);\n            }\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n    handle_left(_jm, e) {\n        this._handle_direction(_jm, e, Direction.left);\n    }\n    handle_right(_jm, e) {\n        this._handle_direction(_jm, e, Direction.right);\n    }\n    _handle_direction(_jm, e, d) {\n        var evt = e || event;\n        var selected_node = _jm.get_selected_node();\n        var node = null;\n        if (!!selected_node) {\n            if (selected_node.isroot) {\n                var c = selected_node.children;\n                var children = [];\n                for (var i = 0; i < c.length; i++) {\n                    if (c[i].direction === d) {\n                        children.push(i);\n                    }\n                }\n                node = c[children[Math.floor((children.length - 1) / 2)]];\n            } else if (selected_node.direction === d) {\n                var children = selected_node.children;\n                var children_count = children.length;\n                if (children_count > 0) {\n                    node = children[Math.floor((children_count - 1) / 2)];\n                }\n            } else {\n                node = selected_node.parent;\n            }\n            if (!!node) {\n                _jm.select_node(node);\n            }\n            evt.stopPropagation();\n            evt.preventDefault();\n        }\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { $ } from './jsmind.dom.js';\n\nconst plugin_data = {\n    plugins: [],\n};\n\nexport function register(plugin) {\n    if (!(plugin instanceof Plugin)) {\n        throw new Error('can not register plugin, it is not an instance of Plugin');\n    }\n    if (plugin_data.plugins.map(p => p.name).includes(plugin.name)) {\n        throw new Error('can not register plugin ' + plugin.name + ': plugin name already exist');\n    }\n    plugin_data.plugins.push(plugin);\n}\n\nexport function apply(jm, options) {\n    $.w.setTimeout(function () {\n        _apply(jm, options);\n    }, 0);\n}\n\nfunction _apply(jm, options) {\n    plugin_data.plugins.forEach(p => p.fn_init(jm, options[p.name]));\n}\n\nexport class Plugin {\n    // function fn_init(jm, options){ }\n    constructor(name, fn_init) {\n        if (!name) {\n            throw new Error('plugin must has a name');\n        }\n        if (!fn_init || typeof fn_init !== 'function') {\n            throw new Error('plugin must has an init function');\n        }\n        this.name = name;\n        this.fn_init = fn_init;\n    }\n}\n","/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport { __version__, logger, EventType, Direction, LogLevel } from './jsmind.common.js';\nimport { merge_option } from './jsmind.option.js';\nimport { Mind } from './jsmind.mind.js';\nimport { Node } from './jsmind.node.js';\nimport { DataProvider } from './jsmind.data_provider.js';\nimport { LayoutProvider } from './jsmind.layout_provider.js';\nimport { ViewProvider } from './jsmind.view_provider.js';\nimport { ShortcutProvider } from './jsmind.shortcut_provider.js';\nimport { Plugin, register as _register_plugin, apply as apply_plugins } from './jsmind.plugin.js';\nimport { format } from './jsmind.format.js';\nimport { $ } from './jsmind.dom.js';\nimport { util as _util } from './jsmind.util.js';\n\nexport default class jsMind {\n    static mind = Mind;\n    static node = Node;\n    static direction = Direction;\n    static event_type = EventType;\n    static $ = $;\n    static plugin = Plugin;\n    static register_plugin = _register_plugin;\n    static util = _util;\n\n    constructor(options) {\n        jsMind.current = this;\n        this.options = merge_option(options);\n        logger.level(LogLevel[this.options.log_level]);\n        this.version = __version__;\n        this.initialized = false;\n        this.mind = null;\n        this.event_handles = [];\n        this.init();\n    }\n\n    init() {\n        if (!!this.initialized) {\n            return;\n        }\n        this.initialized = true;\n        var opts_layout = {\n            mode: this.options.mode,\n            // type: this.options.layout.type,\n            hspace: this.options.layout.hspace,\n            vspace: this.options.layout.vspace,\n            pspace: this.options.layout.pspace,\n            cousin_space: this.options.layout.cousin_space,\n        };\n        var opts_view = {\n            container: this.options.container,\n            support_html: this.options.support_html,\n            engine: this.options.view.engine,\n            hmargin: this.options.view.hmargin,\n            vmargin: this.options.view.vmargin,\n            line_width: this.options.view.line_width,\n            line_color: this.options.view.line_color,\n            line_style: this.options.view.line_style,\n            draggable: this.options.view.draggable,\n            hide_scrollbars_when_draggable: this.options.view.hide_scrollbars_when_draggable,\n            node_overflow: this.options.view.node_overflow,\n            zoom: this.options.view.zoom,\n            custom_node_render: this.options.view.custom_node_render,\n            expander_style: this.options.view.expander_style,\n        };\n        // create instance of function provider\n        this.data = new DataProvider(this);\n        this.layout = new LayoutProvider(this, opts_layout);\n        this.view = new ViewProvider(this, opts_view);\n        this.shortcut = new ShortcutProvider(this, this.options.shortcut);\n\n        this.data.init();\n        this.layout.init();\n        this.view.init();\n        this.shortcut.init();\n\n        this._event_bind();\n\n        apply_plugins(this, this.options.plugin);\n    }\n    get_editable() {\n        return this.options.editable;\n    }\n    enable_edit() {\n        this.options.editable = true;\n    }\n    disable_edit() {\n        this.options.editable = false;\n    }\n    get_view_draggable() {\n        return this.options.view.draggable;\n    }\n    enable_view_draggable() {\n        this.options.view.draggable = true;\n        this.view.setup_canvas_draggable(true);\n    }\n    disable_view_draggable() {\n        this.options.view.draggable = false;\n        this.view.setup_canvas_draggable(false);\n    }\n    // options are 'mousedown', 'click', 'dblclick', 'mousewheel'\n    enable_event_handle(event_handle) {\n        this.options.default_event_handle['enable_' + event_handle + '_handle'] = true;\n    }\n    // options are 'mousedown', 'click', 'dblclick', 'mousewheel'\n    disable_event_handle(event_handle) {\n        this.options.default_event_handle['enable_' + event_handle + '_handle'] = false;\n    }\n    set_theme(theme) {\n        var theme_old = this.options.theme;\n        this.options.theme = !!theme ? theme : null;\n        if (theme_old != this.options.theme) {\n            this.view.reset_theme();\n            this.view.reset_custom_style();\n        }\n    }\n    _event_bind() {\n        this.view.add_event(this, 'mousedown', this.mousedown_handle);\n        this.view.add_event(this, 'click', this.click_handle);\n        this.view.add_event(this, 'dblclick', this.dblclick_handle);\n        this.view.add_event(this, 'mousewheel', this.mousewheel_handle, true);\n        this.view.add_event(this, 'contextmenu', this.contextmenu_handle);\n    }\n    mousedown_handle(e) {\n        if (!this.options.default_event_handle['enable_mousedown_handle']) {\n            return;\n        }\n        var element = e.target || event.srcElement;\n        var node_id = this.view.get_binded_nodeid(element);\n        if (!!node_id) {\n            if (this.view.is_node(element)) {\n                this.select_node(node_id);\n            }\n        } else {\n            this.select_clear();\n        }\n    }\n    click_handle(e) {\n        if (!this.options.default_event_handle['enable_click_handle']) {\n            return;\n        }\n        var element = e.target || event.srcElement;\n        var is_expander = this.view.is_expander(element);\n        if (is_expander) {\n            var node_id = this.view.get_binded_nodeid(element);\n            if (!!node_id) {\n                this.toggle_node(node_id);\n            }\n        }\n    }\n    dblclick_handle(e) {\n        if (!this.options.default_event_handle['enable_dblclick_handle']) {\n            return;\n        }\n        if (this.get_editable()) {\n            var element = e.target || event.srcElement;\n            var is_node = this.view.is_node(element);\n            if (is_node) {\n                var node_id = this.view.get_binded_nodeid(element);\n                if (!!node_id) {\n                    this.begin_edit(node_id);\n                }\n            }\n        }\n    }\n    // Use [Ctrl] + Mousewheel, to zoom in/out.\n    mousewheel_handle(e) {\n        // Test if mousewheel option is enabled and Ctrl key is pressed.\n        if (!this.options.default_event_handle['enable_mousewheel_handle'] || !e.ctrlKey) {\n            return;\n        }\n        var evt = e || event;\n        // Avoid default page scrolling behavior.\n        evt.preventDefault();\n\n        if (evt.deltaY < 0) {\n            this.view.zoom_in(evt); // wheel down\n        } else {\n            this.view.zoom_out(evt);\n        }\n    }\n    begin_edit(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return false;\n            } else {\n                return this.begin_edit(the_node);\n            }\n        }\n        if (this.get_editable()) {\n            this.view.edit_node_begin(node);\n        } else {\n            logger.error('fail, this mind map is not editable.');\n            return;\n        }\n    }\n    end_edit() {\n        this.view.edit_node_end();\n    }\n    toggle_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.toggle_node(the_node);\n            }\n        }\n        if (node.isroot) {\n            return;\n        }\n        this.view.save_location(node);\n        this.layout.toggle_node(node);\n        this.view.relayout();\n        this.view.restore_location(node);\n    }\n    expand_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.expand_node(the_node);\n            }\n        }\n        if (node.isroot) {\n            return;\n        }\n        this.view.save_location(node);\n        this.layout.expand_node(node);\n        this.view.relayout();\n        this.view.restore_location(node);\n    }\n    collapse_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.collapse_node(the_node);\n            }\n        }\n        if (node.isroot) {\n            return;\n        }\n        this.view.save_location(node);\n        this.layout.collapse_node(node);\n        this.view.relayout();\n        this.view.restore_location(node);\n    }\n    expand_all() {\n        this.layout.expand_all();\n        this.view.relayout();\n    }\n    collapse_all() {\n        this.layout.collapse_all();\n        this.view.relayout();\n    }\n    expand_to_depth(depth) {\n        this.layout.expand_to_depth(depth);\n        this.view.relayout();\n    }\n    _reset() {\n        this.view.reset();\n        this.layout.reset();\n        this.data.reset();\n    }\n    _show(mind) {\n        var m = mind || format.node_array.example;\n\n        this.mind = this.data.load(m);\n        if (!this.mind) {\n            logger.error('data.load error');\n            return;\n        } else {\n            logger.debug('data.load ok');\n        }\n\n        this.view.load();\n        logger.debug('view.load ok');\n\n        this.layout.layout();\n        logger.debug('layout.layout ok');\n\n        this.view.show(true);\n        logger.debug('view.show ok');\n\n        this.invoke_event_handle(EventType.show, { data: [mind] });\n    }\n    show(mind) {\n        this._reset();\n        this._show(mind);\n    }\n    get_meta() {\n        return {\n            name: this.mind.name,\n            author: this.mind.author,\n            version: this.mind.version,\n        };\n    }\n    get_data(data_format) {\n        var df = data_format || 'node_tree';\n        var data = this.data.get_data(df);\n        if (df === 'node_array') {\n            data.data.forEach(node => {\n                if (node.data) {\n                    Object.assign(node, node.data);\n                }\n            });\n        }\n        return data;\n    }\n    get_root() {\n        return this.mind.root;\n    }\n    get_node(node) {\n        if (Node.is_node(node)) {\n            return node;\n        }\n        return this.mind.get_node(node);\n    }\n    add_node(parent_node, node_id, topic, data, direction) {\n        if (this.get_editable()) {\n            var the_parent_node = this.get_node(parent_node);\n            var dir = Direction.of(direction);\n            if (dir === undefined) {\n                dir = this.layout.calculate_next_child_direction(the_parent_node);\n            }\n            var node = this.mind.add_node(the_parent_node, node_id, topic, data, dir);\n            if (!!node) {\n                this.view.add_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.view.reset_node_custom_style(node);\n                this.expand_node(the_parent_node);\n                this.invoke_event_handle(EventType.edit, {\n                    evt: 'add_node',\n                    data: [the_parent_node.id, node_id, topic, data, dir],\n                    node: node_id,\n                });\n            }\n            return node;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    insert_node_before(node_before, node_id, topic, data, direction) {\n        if (this.get_editable()) {\n            var the_node_before = this.get_node(node_before);\n            var dir = Direction.of(direction);\n            if (dir === undefined) {\n                dir = this.layout.calculate_next_child_direction(the_node_before.parent);\n            }\n            var node = this.mind.insert_node_before(the_node_before, node_id, topic, data, dir);\n            if (!!node) {\n                this.view.add_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, {\n                    evt: 'insert_node_before',\n                    data: [the_node_before.id, node_id, topic, data, dir],\n                    node: node_id,\n                });\n            }\n            return node;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    insert_node_after(node_after, node_id, topic, data, direction) {\n        if (this.get_editable()) {\n            var the_node_after = this.get_node(node_after);\n            var dir = Direction.of(direction);\n            if (dir === undefined) {\n                dir = this.layout.calculate_next_child_direction(the_node_after.parent);\n            }\n            var node = this.mind.insert_node_after(the_node_after, node_id, topic, data, dir);\n            if (!!node) {\n                this.view.add_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, {\n                    evt: 'insert_node_after',\n                    data: [the_node_after.id, node_id, topic, data, dir],\n                    node: node_id,\n                });\n            }\n            return node;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    remove_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return false;\n            } else {\n                return this.remove_node(the_node);\n            }\n        }\n        if (this.get_editable()) {\n            if (node.isroot) {\n                logger.error('fail, can not remove root node');\n                return false;\n            }\n            var node_id = node.id;\n            var parent_id = node.parent.id;\n            var parent_node = this.get_node(parent_id);\n            this.view.save_location(parent_node);\n            this.view.remove_node(node);\n            this.mind.remove_node(node);\n            this.layout.layout();\n            this.view.show(false);\n            this.view.restore_location(parent_node);\n            this.invoke_event_handle(EventType.edit, {\n                evt: 'remove_node',\n                data: [node_id],\n                node: parent_id,\n            });\n            return true;\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return false;\n        }\n    }\n    update_node(node_id, topic) {\n        if (this.get_editable()) {\n            if (_util.text.is_empty(topic)) {\n                logger.warn('fail, topic can not be empty');\n                return;\n            }\n            var node = this.get_node(node_id);\n            if (!!node) {\n                if (node.topic === topic) {\n                    logger.info('nothing changed');\n                    this.view.update_node(node);\n                    return;\n                }\n                node.topic = topic;\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, {\n                    evt: 'update_node',\n                    data: [node_id, topic],\n                    node: node_id,\n                });\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return;\n        }\n    }\n    move_node(node_id, before_id, parent_id, direction) {\n        if (this.get_editable()) {\n            var node = this.get_node(node_id);\n            var updated_node = this.mind.move_node(node, before_id, parent_id, direction);\n            if (!!updated_node) {\n                this.view.update_node(updated_node);\n                this.layout.layout();\n                this.view.show(false);\n                this.invoke_event_handle(EventType.edit, {\n                    evt: 'move_node',\n                    data: [node_id, before_id, parent_id, direction],\n                    node: node_id,\n                });\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return;\n        }\n    }\n    select_node(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.select_node(the_node);\n            }\n        }\n        if (!this.layout.is_visible(node)) {\n            return;\n        }\n        this.mind.selected = node;\n        this.view.select_node(node);\n        this.invoke_event_handle(EventType.select, { evt: 'select_node', data: [], node: node.id });\n    }\n    get_selected_node() {\n        if (!!this.mind) {\n            return this.mind.selected;\n        } else {\n            return null;\n        }\n    }\n    select_clear() {\n        if (!!this.mind) {\n            this.mind.selected = null;\n            this.view.select_clear();\n        }\n    }\n    is_node_visible(node) {\n        return this.layout.is_visible(node);\n    }\n    scroll_node_to_center(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n            } else {\n                this.scroll_node_to_center(the_node);\n            }\n            return;\n        }\n        this.view.center_node(node);\n    }\n    find_node_before(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.find_node_before(the_node);\n            }\n        }\n        if (node.isroot) {\n            return null;\n        }\n        var n = null;\n        if (node.parent.isroot) {\n            var c = node.parent.children;\n            var prev = null;\n            var ni = null;\n            for (var i = 0; i < c.length; i++) {\n                ni = c[i];\n                if (node.direction === ni.direction) {\n                    if (node.id === ni.id) {\n                        n = prev;\n                    }\n                    prev = ni;\n                }\n            }\n        } else {\n            n = this.mind.get_node_before(node);\n        }\n        return n;\n    }\n    find_node_after(node) {\n        if (!Node.is_node(node)) {\n            var the_node = this.get_node(node);\n            if (!the_node) {\n                logger.error('the node[id=' + node + '] can not be found.');\n                return;\n            } else {\n                return this.find_node_after(the_node);\n            }\n        }\n        if (node.isroot) {\n            return null;\n        }\n        var n = null;\n        if (node.parent.isroot) {\n            var c = node.parent.children;\n            var found = false;\n            var ni = null;\n            for (var i = 0; i < c.length; i++) {\n                ni = c[i];\n                if (node.direction === ni.direction) {\n                    if (found) {\n                        n = ni;\n                        break;\n                    }\n                    if (node.id === ni.id) {\n                        found = true;\n                    }\n                }\n            }\n        } else {\n            n = this.mind.get_node_after(node);\n        }\n        return n;\n    }\n    set_node_color(node_id, bg_color, fg_color) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(node_id);\n            if (!!node) {\n                if (!!bg_color) {\n                    node.data['background-color'] = bg_color;\n                }\n                if (!!fg_color) {\n                    node.data['foreground-color'] = fg_color;\n                }\n                this.view.reset_node_custom_style(node);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    set_node_font_style(node_id, size, weight, style) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(node_id);\n            if (!!node) {\n                if (!!size) {\n                    node.data['font-size'] = size;\n                }\n                if (!!weight) {\n                    node.data['font-weight'] = weight;\n                }\n                if (!!style) {\n                    node.data['font-style'] = style;\n                }\n                this.view.reset_node_custom_style(node);\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    set_node_background_image(node_id, image, width, height, rotation) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(node_id);\n            if (!!node) {\n                if (!!image) {\n                    node.data['background-image'] = image;\n                }\n                if (!!width) {\n                    node.data['width'] = width;\n                }\n                if (!!height) {\n                    node.data['height'] = height;\n                }\n                if (!!rotation) {\n                    node.data['background-rotation'] = rotation;\n                }\n                this.view.reset_node_custom_style(node);\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    set_node_background_rotation(node_id, rotation) {\n        if (this.get_editable()) {\n            var node = this.mind.get_node(node_id);\n            if (!!node) {\n                if (!node.data['background-image']) {\n                    logger.error(\n                        'fail, only can change rotation angle of node with background image'\n                    );\n                    return null;\n                }\n                node.data['background-rotation'] = rotation;\n                this.view.reset_node_custom_style(node);\n                this.view.update_node(node);\n                this.layout.layout();\n                this.view.show(false);\n            }\n        } else {\n            logger.error('fail, this mind map is not editable');\n            return null;\n        }\n    }\n    resize() {\n        this.view.resize();\n    }\n    // callback(type ,data)\n    add_event_listener(callback) {\n        if (typeof callback === 'function') {\n            this.event_handles.push(callback);\n        }\n    }\n    clear_event_listener() {\n        this.event_handles = [];\n    }\n    invoke_event_handle(type, data) {\n        var j = this;\n        $.w.setTimeout(function () {\n            j._invoke_event_handle(type, data);\n        }, 0);\n    }\n    _invoke_event_handle(type, data) {\n        var l = this.event_handles.length;\n        for (var i = 0; i < l; i++) {\n            this.event_handles[i](type, data);\n        }\n    }\n\n    contextmenu_handle(e) {\n        e.preventDefault();\n        var element = e.target;\n        var node_id = this.view.get_binded_nodeid(element);\n        if (!!node_id) {\n            this.select_node(node_id);\n            this.view.show_contextmenu(node_id, e.clientX, e.clientY);\n        }\n    }\n\n    get_nodearray_data() {\n        var mind_data = this.get_data('node_array');\n        var mind_string = jsMind.util.json.json2string(mind_data);\n        // this.prompt_info(mind_string);\n        console.log(mind_string);\n    }\n\n    save_nodearray_file() {\n        var mind_data = this.get_data('node_array');\n        var mind_name = mind_data.meta.name;\n        var mind_str = jsMind.util.json.json2string(mind_data);\n        jsMind.util.file.save(mind_str, 'text/jsmind', mind_name + '.jm');\n    }\n\n    open_nodearray() {\n        var file_input = document.getElementById('file_input_nodearray');\n        var files = file_input.files;\n        if (files.length > 0) {\n            var file_data = files[0];\n            _util.file.read(file_data, (jsmind_data, jsmind_name) => {\n                var mind = _util.json.string2json(jsmind_data);\n                if (!!mind) {\n                    this.show(mind);\n                    this.view.reset_custom_style();\n                } else {\n                    this.prompt_info('can not open this file as mindmap');\n                }\n            });\n        } else {\n            this.prompt_info('please choose a file first');\n        }\n    }\n\n    prompt_info(msg) {\n        alert(msg);\n    }\n\n    static show(options, mind) {\n        logger.warn(\n            '`jsMind.show(options, mind)` is deprecated, please use `jm = new jsMind(options); jm.show(mind);` instead'\n        );\n        var _jm = new jsMind(options);\n        _jm.show(mind);\n        return _jm;\n    }\n}\n"],"names":["__version__","String","prototype","startsWith","p","this","slice","length","Direction","top","left","center","right","down","of","dir","parseInt","toLowerCase","EventType","show","resize","edit","select","LogLevel","debug","info","warn","error","disable","_noop","logger","console","level","log","log_level","$","constructor","w","d","document","g","id","getElementById","c","tag","createElement","t","n","hasChildNodes","firstChild","nodeValue","appendChild","createTextNode","h","HTMLElement","innerHTML","i","el","nodeType","style","ownerDocument","on","e","addEventListener","attachEvent","off","removeEventListener","detachEvent","window","util","file","read","file_data","fn_callback","reader","FileReader","onload","result","name","readAsText","save","type","blob","Blob","bb","BlobBuilder","MozBlobBuilder","WebKitBlobBuilder","MSBlobBuilder","append","getBlob","navigator","msSaveBlob","blob_url","URL","webkitURL","createObjectURL","anchor","visibility","href","download","body","evt","createEvent","initEvent","dispatchEvent","removeChild","location","json","json2string","JSON","stringify","string2json","json_str","parse","merge","b","a","o","Object","toString","call","uuid","newid","Date","getTime","Math","random","substring","text","is_empty","s","replace","default_options","container","editable","theme","mode","support_html","view","engine","hmargin","vmargin","line_width","line_color","line_style","draggable","hide_scrollbars_when_draggable","node_overflow","zoom","min","max","step","custom_node_render","expander_style","layout","hspace","vspace","pspace","cousin_space","default_event_handle","enable_mousedown_handle","enable_click_handle","enable_dblclick_handle","enable_mousewheel_handle","shortcut","enable","handles","mapping","addchild","addbrother","editnode","delnode","toggle","up","plugin","Node","sId","iIndex","sTopic","oData","bIsRoot","oParent","eDirection","bExpanded","index","topic","data","isroot","parent","direction","expanded","children","_data","get_location","vd","x","abs_x","y","abs_y","get_size","width","height","static","node1","node2","i1","i2","parent_node","node","pid","Mind","author","version","root","selected","nodes","get_node","node_id","set_root","_put_node","add_node","idx","is_node","push","_update_index","insert_node_before","node_before","node_index","get_node_before","the_node","insert_node_after","node_after","get_node_after","move_node","before_id","parent_id","_move_node","_flow_node_direction","len","_move_node_internal","inherited","sibling","si","splice","origin_parent","remove_node","ci","node_parent","k","sort","compare","DEFAULT_META","format","node_tree","example","meta","get_mind","source","df","mind","_parse","get_data","_build_node","node_root","_extract_data","_extract_subnode","node_json","node_data","node_array","_array","reverse","root_node","_extract_root","root_json","extract_count","parentid","node_direction","sub_extract_count","_array_node","freemind","xml","xml_doc","_parse_xml","xml_root","_find_root","_load_node","xml_lines","_build_map","join","DOMParser","parseFromString","ActiveXObject","async","loadXML","childNodes","tagName","ns","xml_node","getAttribute","node_topic","node_folded","topic_children","topic_child","textContent","_load_attributes","node_expanded","node_position","child","attr","attr_data","pos","_escape","_line_regex","lines","split","_fill_nodes","node_path","line","match","substr","diff","pop","_build_lines","prefix","Array","DataProvider","jm","init","reset","load","mind_data","data_format","LayoutProvider","options","opts","isside","bounds","cache_valid","calculate_next_child_direction","children_len","r","layout_direction","layout_offset","_layout_direction_root","layout_data","children_count","side_index","_layout_direction_side","subnode","offset_x","offset_y","outer_height","left_nodes","right_nodes","down_nodes","top_nodes","unshift","outer_height_left","_layout_offset_subnodes","outer_height_right","_layout_offset_right_subnodes","outer_height_down","outer_height_top","_layout_offset_top_subnodes","total_height","nodes_count","node_outer_height","base_y","pd","set_visible","findRootAndLongestFunctionWidth","currentObj","functionLongestWidth","functionNodes","filter","forEach","rootObject","longestWidth","middle_height","element_node_outer_height","el_layout_data","el_base_y","function_node","functionWidth","failureWidth","element","j","currentIndex","findIndex","nextNode","nodeFunction","nodeFailureLength","nodeFailure","nodeElement","level1NodeElNum","level2NodeFunction","level3NodeFunction","level2nodeFailureLength","level3nodeFailureLength","childNode","grandChildNode","level1NodeFuntionNum","level3NodeElementNum","nodeFailureNum","function1Width","failure1Width","element2Width","function2Width","failure2Width","funtion_node","l","allNodes","currentIndexIndex","nodelevel3Element","level2Element","level2FunctionNum","level2FailureNum","level3Element","level3FunctionNum","level3FailureNum","nodeFF","level2ElementWidth","level3ElementWidth","level1FuntionWidth","level2FuntionWidth","level3FuntionWidth","nodeFailureNumSum","_layout_offset_subnodes_height","get_node_offset","offset_cache","_offset_","offset_p","get_node_point","view_data","get_node_point_in","get_node_point_out","pout_cache","_pout_","get_expander_point","ex_p","ceil","get_min_size","pout","toggle_node","collapse_node","expand_node","part_layout","invoke_event_handle","expand_all","collapse_all","expand_to_depth","target_depth","curr_nodes","curr_depth","depth","root_layout_data","visible","is_expand","is_visible","SvgGraph","e_svg","setAttribute","size","line_drawing","straight","_line_to","curved","_bezier_to","drawing","createElementNS","set_size","clear","draw_line","pin","offset","color","copy_to","dest_canvas_ctx","callback","img","Image","drawImage","src","btoa","XMLSerializer","serializeToString","path","x1","y1","x2","y2","CanvasGraph","e_canvas","className","canvas_ctx","getContext","clearRect","ctx","strokeStyle","lineWidth","lineCap","beginPath","moveTo","bezierCurveTo","stroke","lineTo","ViewProvider","e_panel","e_nodes","selected_node","editing_node","graph","render_node","_custom_node_render","_default_node_render","_initialized","contextmenu_node_id","e_editor","tabIndex","zoom_current","v","event","keyCode","edit_node_end","stopPropagation","offsetParent","IntersectionObserver","entities","observer","isIntersecting","unobserve","observe","add_event","obj","event_name","event_handle","capture_by_panel","target","get_binded_nodeid","parentElement","is_expander","clear_lines","clear_nodes","reset_theme","theme_name","reset_custom_style","nodeid","reset_node_custom_style","setup_canvas_draggable","init_nodes","expand_size","min_size","min_width","min_height","client_w","clientWidth","client_h","clientHeight","init_nodes_size","doc_frag","createDocumentFragment","create_node_element","run_in_c11y_mode_if_needed","func","position","d_e","expander","_reset_node_custom_style","update_node","origin_style","select_node","restore_selected_node_custom_style","clear_selected_node_custom_style","select_clear","get_editing_node","is_editing","edit_node_begin","ncs","getComputedStyle","value","getPropertyValue","zIndex","focus","get_view_offset","_show","show_nodes","show_lines","zoom_in","set_zoom","zoom_out","e_panel_rect","getBoundingClientRect","zoom_center","panel_scroll_x","scrollLeft","panel_scroll_y","scrollTop","keep_center","center_node","relayout","save_location","_saved_location","restore_location","node_element","view_offset","display","_show_expander","expander_text","_get_expander_text","p_expander","ele","backgroundColor","fontSize","fontWeight","fontStyle","backgroundImage","scaledImageData","toDataURL","backgroundSize","transform","borderBottom","enabled","dragging","eventDown","clientX","clientY","eventMove","scrollBy","node_center_point","scrollTo","zoomIn","zoomOut","setZoom","show_contextmenu","hide_contextmenu","menu","_contextmenu_item_click","bind","panel_rect","minWidth","minHeight","hideFn","_menu_close_handler","menus","querySelectorAll","action","option_color","new_node_id","jsMind","new_node","begin_edit","set_node_option_color","ShortcutProvider","_newid","_mapping","handle","handler","handle_addchild","handle_addbrother","handle_editnode","handle_delnode","handle_toggle","handle_up","handle_down","handle_left","handle_right","keys","isArray","key","id_generator","enable_shortcut","disable_shortcut","which","preventDefault","kc","metaKey","ctrlKey","altKey","shiftKey","_jm","get_selected_node","up_node","find_node_before","np","down_node","find_node_after","_handle_direction","floor","plugin_data","plugins","register","Plugin","Error","map","includes","apply","setTimeout","fn_init","_apply","_register_plugin","_util","current","merge_option","initialized","event_handles","opts_layout","opts_view","_event_bind","apply_plugins","get_editable","enable_edit","disable_edit","get_view_draggable","enable_view_draggable","disable_view_draggable","enable_event_handle","disable_event_handle","set_theme","theme_old","mousedown_handle","click_handle","dblclick_handle","mousewheel_handle","contextmenu_handle","srcElement","deltaY","end_edit","_reset","m","get_meta","assign","get_root","the_parent_node","undefined","the_node_before","the_node_after","updated_node","is_node_visible","scroll_node_to_center","prev","ni","found","set_node_color","bg_color","fg_color","set_node_font_style","weight","set_node_background_image","image","rotation","set_node_background_rotation","add_event_listener","clear_event_listener","_invoke_event_handle","get_nodearray_data","mind_string","save_nodearray_file","mind_name","mind_str","open_nodearray","files","jsmind_data","jsmind_name","prompt_info","msg","alert"],"mappings":"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"}